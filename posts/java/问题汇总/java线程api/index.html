<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Java线程API - MyBlog</title><meta name="Description" content="我的博客"><meta property="og:title" content="Java线程API" />
<meta property="og:description" content="参考： https://blog.csdn.net/sinat_39634657/article/details/81456810 https://blog.csdn.net/suifeng3051/article/details/49443835 https://blog.csdn.net/suifeng3051/article/details/49444177 Runnable Runnable 接口通过 run 方法实现线程逻辑，该方法没有返回值，且不能抛出异常。将该接口的实现作为构造参数传入 Thread 构造方法，然后调用 Thread 的 start() 方法即" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/" />
<meta property="og:image" content="https://msdemt.github.io/logo.png"/>
<meta property="article:published_time" content="2021-02-18T17:52:50+08:00" />
<meta property="article:modified_time" content="2021-02-18T17:52:50+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://msdemt.github.io/logo.png"/>

<meta name="twitter:title" content="Java线程API"/>
<meta name="twitter:description" content="参考： https://blog.csdn.net/sinat_39634657/article/details/81456810 https://blog.csdn.net/suifeng3051/article/details/49443835 https://blog.csdn.net/suifeng3051/article/details/49444177 Runnable Runnable 接口通过 run 方法实现线程逻辑，该方法没有返回值，且不能抛出异常。将该接口的实现作为构造参数传入 Thread 构造方法，然后调用 Thread 的 start() 方法即"/>
<meta name="application-name" content="LoveIt">
<meta name="apple-mobile-web-app-title" content="LoveIt"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/" /><link rel="prev" href="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/springboot&#43;netty&#43;websocket%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Java线程API",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/msdemt.github.io\/posts\/java\/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB\/java%E7%BA%BF%E7%A8%8Bapi\/"
        },"image": ["https:\/\/msdemt.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  16217 ,
        "url": "https:\/\/msdemt.github.io\/posts\/java\/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB\/java%E7%BA%BF%E7%A8%8Bapi\/","datePublished": "2021-02-18T17:52:50+08:00","dateModified": "2021-02-18T17:52:50+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/msdemt.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "xxxx"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="MyBlog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>MyBlog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="MyBlog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>MyBlog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/dillonzq/LoveIt" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Java线程API</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>xxxx</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-02-18">2021-02-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 16217 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 33 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#runnable">Runnable</a></li>
    <li><a href="#callable">Callable</a></li>
    <li><a href="#future">Future</a></li>
    <li><a href="#futuretask">FutureTask</a></li>
    <li><a href="#executor">Executor</a></li>
    <li><a href="#executorservice">ExecutorService</a>
      <ul>
        <li><a href="#executorservice-介绍">ExecutorService 介绍</a></li>
        <li><a href="#executorservice-的创建">ExecutorService 的创建</a></li>
        <li><a href="#executorservice-的使用">ExecutorService 的使用</a></li>
        <li><a href="#executorservice-的执行">ExecutorService 的执行</a>
          <ul>
            <li><a href="#void-executerunnable-command"><code>void execute(Runnable command);</code></a></li>
            <li><a href="#future-submitrunnable-task"><code>Future&lt;?&gt; submit(Runnable task);</code></a></li>
            <li><a href="#t-futuret-submitrunnable-task-t-result"><code>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);</code></a></li>
            <li><a href="#t-futuret-submitcallablet-task"><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);</code></a></li>
            <li><a href="#t-t-invokeanycollection-extends-callablet-tasks-throws-interruptedexception-executionexception"><code>&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException;</code></a></li>
            <li><a href="#t-listfuturet-invokeallcollection-extends-callablet-tasks-throws-interruptedexception"><code>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException;</code></a></li>
          </ul>
        </li>
        <li><a href="#executorservice-的关闭">ExecutorService 的关闭</a></li>
      </ul>
    </li>
    <li><a href="#java-线程池类">java 线程池类</a>
      <ul>
        <li><a href="#threadpoolexecutor">ThreadPoolExecutor</a>
          <ul>
            <li><a href="#threadpoolexecutor-构造方法及作用">ThreadPoolExecutor 构造方法及作用</a></li>
            <li><a href="#线程数量控制">线程数量控制</a></li>
            <li><a href="#unit">unit</a></li>
            <li><a href="#workqueue">workQueue</a></li>
            <li><a href="#handler">handler</a></li>
            <li><a href="#创建一个threadpoolexecutor">创建一个ThreadPoolExecutor</a></li>
          </ul>
        </li>
        <li><a href="#scheduledthreadpoolexecutor">ScheduledThreadPoolExecutor</a>
          <ul>
            <li><a href="#scheduledexecutorservice接口介绍">ScheduledExecutorService接口介绍</a>
              <ul>
                <li><a href="#schedule-runnable-task-long-delay-timeunit-timeunit">schedule (Runnable task, long delay, TimeUnit timeunit)</a></li>
                <li><a href="#schedule-callable-task-long-delay-timeunit-timeunit">schedule (Callable task, long delay, TimeUnit timeunit)</a></li>
                <li><a href="#scheduleatfixedrate-runnable-long-initialdelay-long-period-timeunit-timeunit">scheduleAtFixedRate (Runnable, long initialDelay, long period, TimeUnit timeunit)</a></li>
                <li><a href="#schedulewithfixeddelay-runnable-long-initialdelay-long-period-timeunit-timeunit">scheduleWithFixedDelay (Runnable, long initialDelay, long period, TimeUnit timeunit)</a></li>
                <li><a href="#scheduledexecutorservice的关闭">ScheduledExecutorService的关闭</a></li>
              </ul>
            </li>
            <li><a href="#scheduledthreadpoolexecutor-1">ScheduledThreadPoolExecutor</a></li>
          </ul>
        </li>
        <li><a href="#executors">Executors</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>参考：<br>
<a href="https://blog.csdn.net/sinat_39634657/article/details/81456810">https://blog.csdn.net/sinat_39634657/article/details/81456810</a><br>
<a href="https://blog.csdn.net/suifeng3051/article/details/49443835">https://blog.csdn.net/suifeng3051/article/details/49443835</a><br>
<a href="https://blog.csdn.net/suifeng3051/article/details/49444177">https://blog.csdn.net/suifeng3051/article/details/49444177</a></p>
</blockquote>
<h2 id="runnable">Runnable</h2>
<p>Runnable 接口通过 run 方法实现线程逻辑，该方法没有返回值，且不能抛出异常。将该接口的实现作为构造参数传入 Thread 构造方法，然后调用 Thread 的 start() 方法即可启动线程。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java">
<span class="cm">/**
</span><span class="cm"> * The &lt;code&gt;Runnable&lt;/code&gt; interface should be implemented by any
</span><span class="cm"> * class whose instances are intended to be executed by a thread. The
</span><span class="cm"> * class must define a method of no arguments called &lt;code&gt;run&lt;/code&gt;.
</span><span class="cm"> * &lt;p&gt;
</span><span class="cm"> * This interface is designed to provide a common protocol for objects that
</span><span class="cm"> * wish to execute code while they are active. For example,
</span><span class="cm"> * &lt;code&gt;Runnable&lt;/code&gt; is implemented by class &lt;code&gt;Thread&lt;/code&gt;.
</span><span class="cm"> * Being active simply means that a thread has been started and has not
</span><span class="cm"> * yet been stopped.
</span><span class="cm"> * &lt;p&gt;
</span><span class="cm"> * In addition, &lt;code&gt;Runnable&lt;/code&gt; provides the means for a class to be
</span><span class="cm"> * active while not subclassing &lt;code&gt;Thread&lt;/code&gt;. A class that implements
</span><span class="cm"> * &lt;code&gt;Runnable&lt;/code&gt; can run without subclassing &lt;code&gt;Thread&lt;/code&gt;
</span><span class="cm"> * by instantiating a &lt;code&gt;Thread&lt;/code&gt; instance and passing itself in
</span><span class="cm"> * as the target.  In most cases, the &lt;code&gt;Runnable&lt;/code&gt; interface should
</span><span class="cm"> * be used if you are only planning to override the &lt;code&gt;run()&lt;/code&gt;
</span><span class="cm"> * method and no other &lt;code&gt;Thread&lt;/code&gt; methods.
</span><span class="cm"> * This is important because classes should not be subclassed
</span><span class="cm"> * unless the programmer intends on modifying or enhancing the fundamental
</span><span class="cm"> * behavior of the class.
</span><span class="cm"> *
</span><span class="cm"> * @author  Arthur van Hoff
</span><span class="cm"> * @see     java.lang.Thread
</span><span class="cm"> * @see     java.util.concurrent.Callable
</span><span class="cm"> * @since   JDK1.0
</span><span class="cm"> */</span>
<span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * When an object implementing interface &lt;code&gt;Runnable&lt;/code&gt; is used
</span><span class="cm">     * to create a thread, starting the thread causes the object&#39;s
</span><span class="cm">     * &lt;code&gt;run&lt;/code&gt; method to be called in that separately executing
</span><span class="cm">     * thread.
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * The general contract of the method &lt;code&gt;run&lt;/code&gt; is that it may
</span><span class="cm">     * take any action whatsoever.
</span><span class="cm">     *
</span><span class="cm">     * @see     java.lang.Thread#run()
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="callable">Callable</h2>
<p>Callable 接口通过 call 方法实现线程逻辑，有返回值，且可以抛出异常，可以通过 Callable<V> 中的泛型 V 传入返回值类型</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * A task that returns a result and may throw an exception.
</span><span class="cm"> * Implementors define a single method with no arguments called
</span><span class="cm"> * {@code call}.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;The {@code Callable} interface is similar to {@link
</span><span class="cm"> * java.lang.Runnable}, in that both are designed for classes whose
</span><span class="cm"> * instances are potentially executed by another thread.  A
</span><span class="cm"> * {@code Runnable}, however, does not return a result and cannot
</span><span class="cm"> * throw a checked exception.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;The {@link Executors} class contains utility methods to
</span><span class="cm"> * convert from other common forms to {@code Callable} classes.
</span><span class="cm"> *
</span><span class="cm"> * @see Executor
</span><span class="cm"> * @since 1.5
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> * @param &lt;V&gt; the result type of method {@code call}
</span><span class="cm"> */</span>
<span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Callable</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * Computes a result, or throws an exception if unable to do so.
</span><span class="cm">     *
</span><span class="cm">     * @return computed result
</span><span class="cm">     * @throws Exception if unable to compute a result
</span><span class="cm">     */</span>
    <span class="n">V</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="future">Future</h2>
<p>Future 表示异步计算的结果，提供了一些方法来检查计算是否完成，等待其完成并且获取计算结果。</p>
<p>计算结果只有在计算完成后使用 get() 方法获取，当计算没有完成时，get() 方法会阻塞</p>
<p>可以通过 cancel() 方法取消计算过程。</p>
<p>还有一些其他方法用来判断该计算任务是否正常完成或是否已被取消。</p>
<p>一旦计算任务完成，那该计算任务不能被取消。</p>
<p>如果希望使用 Future 获取可取消的并且没有返回结果的计算任务的结果，那你可以以 Future&lt;?&gt; 的形式进行声明并且计算任务返回 null</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * A {@code Future} represents the result of an asynchronous
</span><span class="cm"> * computation.  Methods are provided to check if the computation is
</span><span class="cm"> * complete, to wait for its completion, and to retrieve the result of
</span><span class="cm"> * the computation.  The result can only be retrieved using method
</span><span class="cm"> * {@code get} when the computation has completed, blocking if
</span><span class="cm"> * necessary until it is ready.  Cancellation is performed by the
</span><span class="cm"> * {@code cancel} method.  Additional methods are provided to
</span><span class="cm"> * determine if the task completed normally or was cancelled. Once a
</span><span class="cm"> * computation has completed, the computation cannot be cancelled.
</span><span class="cm"> * If you would like to use a {@code Future} for the sake
</span><span class="cm"> * of cancellability but not provide a usable result, you can
</span><span class="cm"> * declare types of the form {@code Future&lt;?&gt;} and
</span><span class="cm"> * return {@code null} as a result of the underlying task.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;
</span><span class="cm"> * &lt;b&gt;Sample Usage&lt;/b&gt; (Note that the following classes are all
</span><span class="cm"> * made-up.)
</span><span class="cm"> * &lt;pre&gt; {@code
</span><span class="cm"> * interface ArchiveSearcher { String search(String target); }
</span><span class="cm"> * class App {
</span><span class="cm"> *   ExecutorService executor = ...
</span><span class="cm"> *   ArchiveSearcher searcher = ...
</span><span class="cm"> *   void showSearch(final String target)
</span><span class="cm"> *       throws InterruptedException {
</span><span class="cm"> *     Future&lt;String&gt; future
</span><span class="cm"> *       = executor.submit(new Callable&lt;String&gt;() {
</span><span class="cm"> *         public String call() {
</span><span class="cm"> *             return searcher.search(target);
</span><span class="cm"> *         }});
</span><span class="cm"> *     displayOtherThings(); // do other things while searching
</span><span class="cm"> *     try {
</span><span class="cm"> *       displayText(future.get()); // use future
</span><span class="cm"> *     } catch (ExecutionException ex) { cleanup(); return; }
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * The {@link FutureTask} class is an implementation of {@code Future} that
</span><span class="cm"> * implements {@code Runnable}, and so may be executed by an {@code Executor}.
</span><span class="cm"> * For example, the above construction with {@code submit} could be replaced by:
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * FutureTask&lt;String&gt; future =
</span><span class="cm"> *   new FutureTask&lt;String&gt;(new Callable&lt;String&gt;() {
</span><span class="cm"> *     public String call() {
</span><span class="cm"> *       return searcher.search(target);
</span><span class="cm"> *   }});
</span><span class="cm"> * executor.execute(future);}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;Memory consistency effects: Actions taken by the asynchronous computation
</span><span class="cm"> * &lt;a href=&#34;package-summary.html#MemoryVisibility&#34;&gt; &lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;
</span><span class="cm"> * actions following the corresponding {@code Future.get()} in another thread.
</span><span class="cm"> *
</span><span class="cm"> * @see FutureTask
</span><span class="cm"> * @see Executor
</span><span class="cm"> * @since 1.5
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> * @param &lt;V&gt; The result type returned by this Future&#39;s {@code get} method
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Attempts to cancel execution of this task.  This attempt will
</span><span class="cm">     * fail if the task has already completed, has already been cancelled,
</span><span class="cm">     * or could not be cancelled for some other reason. If successful,
</span><span class="cm">     * and this task has not started when {@code cancel} is called,
</span><span class="cm">     * this task should never run.  If the task has already started,
</span><span class="cm">     * then the {@code mayInterruptIfRunning} parameter determines
</span><span class="cm">     * whether the thread executing this task should be interrupted in
</span><span class="cm">     * an attempt to stop the task.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt;After this method returns, subsequent calls to {@link #isDone} will
</span><span class="cm">     * always return {@code true}.  Subsequent calls to {@link #isCancelled}
</span><span class="cm">     * will always return {@code true} if this method returned {@code true}.
</span><span class="cm">     *
</span><span class="cm">     * @param mayInterruptIfRunning {@code true} if the thread executing this
</span><span class="cm">     * task should be interrupted; otherwise, in-progress tasks are allowed
</span><span class="cm">     * to complete
</span><span class="cm">     * @return {@code false} if the task could not be cancelled,
</span><span class="cm">     * typically because it has already completed normally;
</span><span class="cm">     * {@code true} otherwise
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">cancel</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">mayInterruptIfRunning</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Returns {@code true} if this task was cancelled before it completed
</span><span class="cm">     * normally.
</span><span class="cm">     *
</span><span class="cm">     * @return {@code true} if this task was cancelled before it completed
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">isCancelled</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * Returns {@code true} if this task completed.
</span><span class="cm">     *
</span><span class="cm">     * Completion may be due to normal termination, an exception, or
</span><span class="cm">     * cancellation -- in all of these cases, this method will return
</span><span class="cm">     * {@code true}.
</span><span class="cm">     *
</span><span class="cm">     * @return {@code true} if this task completed
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">isDone</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * Waits if necessary for the computation to complete, and then
</span><span class="cm">     * retrieves its result.
</span><span class="cm">     *
</span><span class="cm">     * @return the computed result
</span><span class="cm">     * @throws CancellationException if the computation was cancelled
</span><span class="cm">     * @throws ExecutionException if the computation threw an
</span><span class="cm">     * exception
</span><span class="cm">     * @throws InterruptedException if the current thread was interrupted
</span><span class="cm">     * while waiting
</span><span class="cm">     */</span>
    <span class="n">V</span> <span class="nf">get</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">,</span> <span class="n">ExecutionException</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * Waits if necessary for at most the given time for the computation
</span><span class="cm">     * to complete, and then retrieves its result, if available.
</span><span class="cm">     *
</span><span class="cm">     * @param timeout the maximum time to wait
</span><span class="cm">     * @param unit the time unit of the timeout argument
</span><span class="cm">     * @return the computed result
</span><span class="cm">     * @throws CancellationException if the computation was cancelled
</span><span class="cm">     * @throws ExecutionException if the computation threw an
</span><span class="cm">     * exception
</span><span class="cm">     * @throws InterruptedException if the current thread was interrupted
</span><span class="cm">     * while waiting
</span><span class="cm">     * @throws TimeoutException if the wait timed out
</span><span class="cm">     */</span>
    <span class="n">V</span> <span class="nf">get</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">,</span> <span class="n">ExecutionException</span><span class="o">,</span> <span class="n">TimeoutException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="futuretask">FutureTask</h2>
<p>FutureTask 是一个可取消的异步计算任务。该类提供了 Future 接口的基本实现，包含了启动、取消、查询计算任务是否完成和获取计算结果的方法。计算结果只能在计算任务完成后获取到， 如果计算任务没有完成，那么 get() 方法会阻塞。一旦计算任务完成，则该计算任务不能被重新启动或者被取消（除了该计算任务被 runAndReset 调用）</p>
<p>FutureTask 可以用来包装 Callable 或者 Runnable 对象，因为 FutureTask 实现了 Runnable 接口，FutureTask 实例可以被注册到 Executor 中进行执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * A cancellable asynchronous computation.  This class provides a base
</span><span class="cm"> * implementation of {@link Future}, with methods to start and cancel
</span><span class="cm"> * a computation, query to see if the computation is complete, and
</span><span class="cm"> * retrieve the result of the computation.  The result can only be
</span><span class="cm"> * retrieved when the computation has completed; the {@code get}
</span><span class="cm"> * methods will block if the computation has not yet completed.  Once
</span><span class="cm"> * the computation has completed, the computation cannot be restarted
</span><span class="cm"> * or cancelled (unless the computation is invoked using
</span><span class="cm"> * {@link #runAndReset}).
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;A {@code FutureTask} can be used to wrap a {@link Callable} or
</span><span class="cm"> * {@link Runnable} object.  Because {@code FutureTask} implements
</span><span class="cm"> * {@code Runnable}, a {@code FutureTask} can be submitted to an
</span><span class="cm"> * {@link Executor} for execution.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;In addition to serving as a standalone class, this class provides
</span><span class="cm"> * {@code protected} functionality that may be useful when creating
</span><span class="cm"> * customized task classes.
</span><span class="cm"> *
</span><span class="cm"> * @since 1.5
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> * @param &lt;V&gt; The result type returned by this FutureTask&#39;s {@code get} methods
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FutureTask</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">RunnableFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
</code></pre></td></tr></table>
</div>
</div><p>RunnableFuture 继承了 Runnable 和 Future 接口</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * A {@link Future} that is {@link Runnable}. Successful execution of
</span><span class="cm"> * the {@code run} method causes completion of the {@code Future}
</span><span class="cm"> * and allows access to its results.
</span><span class="cm"> * @see FutureTask
</span><span class="cm"> * @see Executor
</span><span class="cm"> * @since 1.6
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> * @param &lt;V&gt; The result type returned by this Future&#39;s {@code get} method
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RunnableFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Runnable</span><span class="o">,</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * Sets this Future to the result of its computation
</span><span class="cm">     * unless it has been cancelled.
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">run</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>FutureTask 对 Callable 和 Runnable 进行了包装</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Creates a {@code FutureTask} that will, upon running, execute the
</span><span class="cm"> * given {@code Callable}.
</span><span class="cm"> *
</span><span class="cm"> * @param  callable the callable task
</span><span class="cm"> * @throws NullPointerException if the callable is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">FutureTask</span><span class="o">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">callable</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">callable</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">callable</span> <span class="o">=</span> <span class="n">callable</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">NEW</span><span class="o">;</span>       <span class="c1">// ensure visibility of callable
</span><span class="c1"></span><span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * Creates a {@code FutureTask} that will, upon running, execute the
</span><span class="cm"> * given {@code Runnable}, and arrange that {@code get} will return the
</span><span class="cm"> * given result on successful completion.
</span><span class="cm"> *
</span><span class="cm"> * @param runnable the runnable task
</span><span class="cm"> * @param result the result to return on successful completion. If
</span><span class="cm"> * you don&#39;t need a particular result, consider using
</span><span class="cm"> * constructions of the form:
</span><span class="cm"> * {@code Future&lt;?&gt; f = new FutureTask&lt;Void&gt;(runnable, null)}
</span><span class="cm"> * @throws NullPointerException if the runnable is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">FutureTask</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">runnable</span><span class="o">,</span> <span class="n">V</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">callable</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">callable</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">NEW</span><span class="o">;</span>       <span class="c1">// ensure visibility of callable
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上面代码块可以看出：Runnable 注入会被 Executors.callable() 函数转换为 Callable 类型，即 FutureTask 最终都是执行 Callable 类型的任务。该适配函数的实现如下 ：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Returns a {@link Callable} object that, when
</span><span class="cm"> * called, runs the given task and returns the given result.  This
</span><span class="cm"> * can be useful when applying methods requiring a
</span><span class="cm"> * {@code Callable} to an otherwise resultless action.
</span><span class="cm"> * @param task the task to run
</span><span class="cm"> * @param result the result to return
</span><span class="cm"> * @param &lt;T&gt; the type of the result
</span><span class="cm"> * @return a callable object
</span><span class="cm"> * @throws NullPointerException if task null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">callable</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">task</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RunnableAdapter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">task</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>RunnableAdapter 内容如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * A callable that runs given task and returns given result
</span><span class="cm"> */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">RunnableAdapter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Runnable</span> <span class="n">task</span><span class="o">;</span>
    <span class="kd">final</span> <span class="n">T</span> <span class="n">result</span><span class="o">;</span>
    <span class="n">RunnableAdapter</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>由上可知，FutureTask 实现了 Runnable ，所以能通过 Thread 包装执行</p>
<p>FutureTask 实现了 Runnable ，所以能通过提交给 ExcecuteService 来执行</p>
<p>注：ExcecuteService 是创建线程池实例对象，其中有 submit(Runnable) 、 submit(Callable) 方法</p>
<p>FutureTask 可以通过 get() 方法获得线程的执行结果，注意该函数会阻塞线程，直到结果返回。</p>
<p>因此 FutureTask 是 Future 也是 Runnable ，又是包装了的 Callable (如果是 Runnable 最终也会被转换为Callable )。</p>
<p>Callable 和 Runnable 接口的区别</p>
<ul>
<li>Callable 规定的方法是 call() ，而 Runnable 规定的方法是 run()</li>
<li>Callable 的任务执行后可有返回值，而 Runnable 的任务没有返回值</li>
<li>call() 方法可抛出异常，而 run() 方法不能抛出异常</li>
<li>运行 Callable 任务可拿到一个 Future 对象， Future 表示异步执行的结果，它提供了检查计算是否完成的方法，以等待计算的完成，并检索计算的结果，通过Future对象可了解任务执行情况，可取消任务的执行，还可获取任务执行的结果</li>
</ul>
<h2 id="executor">Executor</h2>
<p>Executor 是可以执行已提交的 Runnable 任务的对象。该接口提供了一种将任务的提交与每个任务运行机制进行解耦的方法，包括线程使用、调度等详细信息。</p>
<p>通常使用 Executor 替代显式地创建显式，例如，不再使用 new Thread(new(RunnableTask())).start() 的方式启动每个线程，而是使用如下方式替代</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">Executor executor = anExecutor;
executor.execute(new RunnableTask1());
executor.execute(new RunnableTask2());
...
</code></pre></td></tr></table>
</div>
</div><p>但是， Executor 接口并不严格要求执行任务是异步的。最简单的情况，执行者可以立即在调用者的线程中运行提交的任务，如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">DirectExecutor</span> <span class="kd">implements</span> <span class="n">Executor</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">r</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>更典型地，任务可以在调用者线程之外的其他线程执行，下面的程序为每个任务新建一个线程</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">ThreadPerTaskExecutor</span> <span class="kd">implements</span> <span class="n">Executor</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>许多 Executor 的实现会对被调度的任务运行方式和运行实现添加某些限制，下面的 executor 将任务提交序列化到第二个执行程序，展示了一个复合执行程序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">class</span> <span class="nc">SerialExecutor</span> <span class="kd">implements</span> <span class="n">Executor</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="n">Queue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">tasks</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayDeque</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;();</span>
  <span class="kd">final</span> <span class="n">Executor</span> <span class="n">executor</span><span class="o">;</span>
  <span class="n">Runnable</span> <span class="n">active</span><span class="o">;</span>

  <span class="n">SerialExecutor</span><span class="o">(</span><span class="n">Executor</span> <span class="n">executor</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">executor</span> <span class="o">=</span> <span class="n">executor</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="kd">final</span> <span class="n">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">tasks</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="n">r</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
          <span class="n">scheduleNext</span><span class="o">();</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">});</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">active</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">scheduleNext</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">scheduleNext</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">((</span><span class="n">active</span> <span class="o">=</span> <span class="n">tasks</span><span class="o">.</span><span class="na">poll</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">active</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Executor 接口完整代码如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * An object that executes submitted {@link Runnable} tasks. This
</span><span class="cm"> * interface provides a way of decoupling task submission from the
</span><span class="cm"> * mechanics of how each task will be run, including details of thread
</span><span class="cm"> * use, scheduling, etc.  An {@code Executor} is normally used
</span><span class="cm"> * instead of explicitly creating threads. For example, rather than
</span><span class="cm"> * invoking {@code new Thread(new(RunnableTask())).start()} for each
</span><span class="cm"> * of a set of tasks, you might use:
</span><span class="cm"> *
</span><span class="cm"> * &lt;pre&gt;
</span><span class="cm"> * Executor executor = &lt;em&gt;anExecutor&lt;/em&gt;;
</span><span class="cm"> * executor.execute(new RunnableTask1());
</span><span class="cm"> * executor.execute(new RunnableTask2());
</span><span class="cm"> * ...
</span><span class="cm"> * &lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * However, the {@code Executor} interface does not strictly
</span><span class="cm"> * require that execution be asynchronous. In the simplest case, an
</span><span class="cm"> * executor can run the submitted task immediately in the caller&#39;s
</span><span class="cm"> * thread:
</span><span class="cm"> *
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * class DirectExecutor implements Executor {
</span><span class="cm"> *   public void execute(Runnable r) {
</span><span class="cm"> *     r.run();
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * More typically, tasks are executed in some thread other
</span><span class="cm"> * than the caller&#39;s thread.  The executor below spawns a new thread
</span><span class="cm"> * for each task.
</span><span class="cm"> *
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * class ThreadPerTaskExecutor implements Executor {
</span><span class="cm"> *   public void execute(Runnable r) {
</span><span class="cm"> *     new Thread(r).start();
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * Many {@code Executor} implementations impose some sort of
</span><span class="cm"> * limitation on how and when tasks are scheduled.  The executor below
</span><span class="cm"> * serializes the submission of tasks to a second executor,
</span><span class="cm"> * illustrating a composite executor.
</span><span class="cm"> *
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * class SerialExecutor implements Executor {
</span><span class="cm"> *   final Queue&lt;Runnable&gt; tasks = new ArrayDeque&lt;Runnable&gt;();
</span><span class="cm"> *   final Executor executor;
</span><span class="cm"> *   Runnable active;
</span><span class="cm"> *
</span><span class="cm"> *   SerialExecutor(Executor executor) {
</span><span class="cm"> *     this.executor = executor;
</span><span class="cm"> *   }
</span><span class="cm"> *
</span><span class="cm"> *   public synchronized void execute(final Runnable r) {
</span><span class="cm"> *     tasks.offer(new Runnable() {
</span><span class="cm"> *       public void run() {
</span><span class="cm"> *         try {
</span><span class="cm"> *           r.run();
</span><span class="cm"> *         } finally {
</span><span class="cm"> *           scheduleNext();
</span><span class="cm"> *         }
</span><span class="cm"> *       }
</span><span class="cm"> *     });
</span><span class="cm"> *     if (active == null) {
</span><span class="cm"> *       scheduleNext();
</span><span class="cm"> *     }
</span><span class="cm"> *   }
</span><span class="cm"> *
</span><span class="cm"> *   protected synchronized void scheduleNext() {
</span><span class="cm"> *     if ((active = tasks.poll()) != null) {
</span><span class="cm"> *       executor.execute(active);
</span><span class="cm"> *     }
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * The {@code Executor} implementations provided in this package
</span><span class="cm"> * implement {@link ExecutorService}, which is a more extensive
</span><span class="cm"> * interface.  The {@link ThreadPoolExecutor} class provides an
</span><span class="cm"> * extensible thread pool implementation. The {@link Executors} class
</span><span class="cm"> * provides convenient factory methods for these Executors.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;Memory consistency effects: Actions in a thread prior to
</span><span class="cm"> * submitting a {@code Runnable} object to an {@code Executor}
</span><span class="cm"> * &lt;a href=&#34;package-summary.html#MemoryVisibility&#34;&gt;&lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;
</span><span class="cm"> * its execution begins, perhaps in another thread.
</span><span class="cm"> *
</span><span class="cm"> * @since 1.5
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Executor</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Executes the given command at some time in the future.  The command
</span><span class="cm">     * may execute in a new thread, in a pooled thread, or in the calling
</span><span class="cm">     * thread, at the discretion of the {@code Executor} implementation.
</span><span class="cm">     *
</span><span class="cm">     * @param command the runnable task
</span><span class="cm">     * @throws RejectedExecutionException if this task cannot be
</span><span class="cm">     * accepted for execution
</span><span class="cm">     * @throws NullPointerException if command is null
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="executorservice">ExecutorService</h2>
<p>ExecutorService 是一个 Executor 的子类，它提供了管理终止的方法，还提供了方法用于生成 Future 实例用来追踪一个或多个异步任务的执行过程。</p>
<p>ExecutorService 可以被关闭，关闭后会拒绝新的任务。有两种方式可以关闭 ExecutorService。 shutdown 方法允许终止ExecutorService 之前提交的任务继续执行， shutdownNow 方法将阻止等待的任务并尝试关闭正在执行的任务。ExecutorService 被关闭后，执行器 executor 没有正在执行的任务，没有等待执行的任务，也无法提交新的任务。该未被使用的 ExecutorService 应该被关闭以回收它占用的资源。</p>
<p>ExecutorService 的完整代码如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * An {@link Executor} that provides methods to manage termination and
</span><span class="cm"> * methods that can produce a {@link Future} for tracking progress of
</span><span class="cm"> * one or more asynchronous tasks.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;An {@code ExecutorService} can be shut down, which will cause
</span><span class="cm"> * it to reject new tasks.  Two different methods are provided for
</span><span class="cm"> * shutting down an {@code ExecutorService}. The {@link #shutdown}
</span><span class="cm"> * method will allow previously submitted tasks to execute before
</span><span class="cm"> * terminating, while the {@link #shutdownNow} method prevents waiting
</span><span class="cm"> * tasks from starting and attempts to stop currently executing tasks.
</span><span class="cm"> * Upon termination, an executor has no tasks actively executing, no
</span><span class="cm"> * tasks awaiting execution, and no new tasks can be submitted.  An
</span><span class="cm"> * unused {@code ExecutorService} should be shut down to allow
</span><span class="cm"> * reclamation of its resources.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;Method {@code submit} extends base method {@link
</span><span class="cm"> * Executor#execute(Runnable)} by creating and returning a {@link Future}
</span><span class="cm"> * that can be used to cancel execution and/or wait for completion.
</span><span class="cm"> * Methods {@code invokeAny} and {@code invokeAll} perform the most
</span><span class="cm"> * commonly useful forms of bulk execution, executing a collection of
</span><span class="cm"> * tasks and then waiting for at least one, or all, to
</span><span class="cm"> * complete. (Class {@link ExecutorCompletionService} can be used to
</span><span class="cm"> * write customized variants of these methods.)
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;The {@link Executors} class provides factory methods for the
</span><span class="cm"> * executor services provided in this package.
</span><span class="cm"> *
</span><span class="cm"> * &lt;h3&gt;Usage Examples&lt;/h3&gt;
</span><span class="cm"> *
</span><span class="cm"> * Here is a sketch of a network service in which threads in a thread
</span><span class="cm"> * pool service incoming requests. It uses the preconfigured {@link
</span><span class="cm"> * Executors#newFixedThreadPool} factory method:
</span><span class="cm"> *
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * class NetworkService implements Runnable {
</span><span class="cm"> *   private final ServerSocket serverSocket;
</span><span class="cm"> *   private final ExecutorService pool;
</span><span class="cm"> *
</span><span class="cm"> *   public NetworkService(int port, int poolSize)
</span><span class="cm"> *       throws IOException {
</span><span class="cm"> *     serverSocket = new ServerSocket(port);
</span><span class="cm"> *     pool = Executors.newFixedThreadPool(poolSize);
</span><span class="cm"> *   }
</span><span class="cm"> *
</span><span class="cm"> *   public void run() { // run the service
</span><span class="cm"> *     try {
</span><span class="cm"> *       for (;;) {
</span><span class="cm"> *         pool.execute(new Handler(serverSocket.accept()));
</span><span class="cm"> *       }
</span><span class="cm"> *     } catch (IOException ex) {
</span><span class="cm"> *       pool.shutdown();
</span><span class="cm"> *     }
</span><span class="cm"> *   }
</span><span class="cm"> * }
</span><span class="cm"> *
</span><span class="cm"> * class Handler implements Runnable {
</span><span class="cm"> *   private final Socket socket;
</span><span class="cm"> *   Handler(Socket socket) { this.socket = socket; }
</span><span class="cm"> *   public void run() {
</span><span class="cm"> *     // read and service request on socket
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * The following method shuts down an {@code ExecutorService} in two phases,
</span><span class="cm"> * first by calling {@code shutdown} to reject incoming tasks, and then
</span><span class="cm"> * calling {@code shutdownNow}, if necessary, to cancel any lingering tasks:
</span><span class="cm"> *
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * void shutdownAndAwaitTermination(ExecutorService pool) {
</span><span class="cm"> *   pool.shutdown(); // Disable new tasks from being submitted
</span><span class="cm"> *   try {
</span><span class="cm"> *     // Wait a while for existing tasks to terminate
</span><span class="cm"> *     if (!pool.awaitTermination(60, TimeUnit.SECONDS)) {
</span><span class="cm"> *       pool.shutdownNow(); // Cancel currently executing tasks
</span><span class="cm"> *       // Wait a while for tasks to respond to being cancelled
</span><span class="cm"> *       if (!pool.awaitTermination(60, TimeUnit.SECONDS))
</span><span class="cm"> *           System.err.println(&#34;Pool did not terminate&#34;);
</span><span class="cm"> *     }
</span><span class="cm"> *   } catch (InterruptedException ie) {
</span><span class="cm"> *     // (Re-)Cancel if current thread also interrupted
</span><span class="cm"> *     pool.shutdownNow();
</span><span class="cm"> *     // Preserve interrupt status
</span><span class="cm"> *     Thread.currentThread().interrupt();
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;Memory consistency effects: Actions in a thread prior to the
</span><span class="cm"> * submission of a {@code Runnable} or {@code Callable} task to an
</span><span class="cm"> * {@code ExecutorService}
</span><span class="cm"> * &lt;a href=&#34;package-summary.html#MemoryVisibility&#34;&gt;&lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;
</span><span class="cm"> * any actions taken by that task, which in turn &lt;i&gt;happen-before&lt;/i&gt; the
</span><span class="cm"> * result is retrieved via {@code Future.get()}.
</span><span class="cm"> *
</span><span class="cm"> * @since 1.5
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ExecutorService</span> <span class="kd">extends</span> <span class="n">Executor</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Initiates an orderly shutdown in which previously submitted
</span><span class="cm">     * tasks are executed, but no new tasks will be accepted.
</span><span class="cm">     * Invocation has no additional effect if already shut down.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt;This method does not wait for previously submitted tasks to
</span><span class="cm">     * complete execution.  Use {@link #awaitTermination awaitTermination}
</span><span class="cm">     * to do that.
</span><span class="cm">     *
</span><span class="cm">     * @throws SecurityException if a security manager exists and
</span><span class="cm">     *         shutting down this ExecutorService may manipulate
</span><span class="cm">     *         threads that the caller is not permitted to modify
</span><span class="cm">     *         because it does not hold {@link
</span><span class="cm">     *         java.lang.RuntimePermission}{@code (&#34;modifyThread&#34;)},
</span><span class="cm">     *         or the security manager&#39;s {@code checkAccess} method
</span><span class="cm">     *         denies access.
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * Attempts to stop all actively executing tasks, halts the
</span><span class="cm">     * processing of waiting tasks, and returns a list of the tasks
</span><span class="cm">     * that were awaiting execution.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt;This method does not wait for actively executing tasks to
</span><span class="cm">     * terminate.  Use {@link #awaitTermination awaitTermination} to
</span><span class="cm">     * do that.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt;There are no guarantees beyond best-effort attempts to stop
</span><span class="cm">     * processing actively executing tasks.  For example, typical
</span><span class="cm">     * implementations will cancel via {@link Thread#interrupt}, so any
</span><span class="cm">     * task that fails to respond to interrupts may never terminate.
</span><span class="cm">     *
</span><span class="cm">     * @return list of tasks that never commenced execution
</span><span class="cm">     * @throws SecurityException if a security manager exists and
</span><span class="cm">     *         shutting down this ExecutorService may manipulate
</span><span class="cm">     *         threads that the caller is not permitted to modify
</span><span class="cm">     *         because it does not hold {@link
</span><span class="cm">     *         java.lang.RuntimePermission}{@code (&#34;modifyThread&#34;)},
</span><span class="cm">     *         or the security manager&#39;s {@code checkAccess} method
</span><span class="cm">     *         denies access.
</span><span class="cm">     */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="nf">shutdownNow</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * Returns {@code true} if this executor has been shut down.
</span><span class="cm">     *
</span><span class="cm">     * @return {@code true} if this executor has been shut down
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">isShutdown</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * Returns {@code true} if all tasks have completed following shut down.
</span><span class="cm">     * Note that {@code isTerminated} is never {@code true} unless
</span><span class="cm">     * either {@code shutdown} or {@code shutdownNow} was called first.
</span><span class="cm">     *
</span><span class="cm">     * @return {@code true} if all tasks have completed following shut down
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">isTerminated</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">     * Blocks until all tasks have completed execution after a shutdown
</span><span class="cm">     * request, or the timeout occurs, or the current thread is
</span><span class="cm">     * interrupted, whichever happens first.
</span><span class="cm">     *
</span><span class="cm">     * @param timeout the maximum time to wait
</span><span class="cm">     * @param unit the time unit of the timeout argument
</span><span class="cm">     * @return {@code true} if this executor terminated and
</span><span class="cm">     *         {@code false} if the timeout elapsed before termination
</span><span class="cm">     * @throws InterruptedException if interrupted while waiting
</span><span class="cm">     */</span>
    <span class="kt">boolean</span> <span class="nf">awaitTermination</span><span class="o">(</span><span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * Submits a value-returning task for execution and returns a
</span><span class="cm">     * Future representing the pending results of the task. The
</span><span class="cm">     * Future&#39;s {@code get} method will return the task&#39;s result upon
</span><span class="cm">     * successful completion.
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt;
</span><span class="cm">     * If you would like to immediately block waiting
</span><span class="cm">     * for a task, you can use constructions of the form
</span><span class="cm">     * {@code result = exec.submit(aCallable).get();}
</span><span class="cm">     *
</span><span class="cm">     * &lt;p&gt;Note: The {@link Executors} class includes a set of methods
</span><span class="cm">     * that can convert some other common closure-like objects,
</span><span class="cm">     * for example, {@link java.security.PrivilegedAction} to
</span><span class="cm">     * {@link Callable} form so they can be submitted.
</span><span class="cm">     *
</span><span class="cm">     * @param task the task to submit
</span><span class="cm">     * @param &lt;T&gt; the type of the task&#39;s result
</span><span class="cm">     * @return a Future representing pending completion of the task
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if the task is null
</span><span class="cm">     */</span>
    <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">task</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Submits a Runnable task for execution and returns a Future
</span><span class="cm">     * representing that task. The Future&#39;s {@code get} method will
</span><span class="cm">     * return the given result upon successful completion.
</span><span class="cm">     *
</span><span class="cm">     * @param task the task to submit
</span><span class="cm">     * @param result the result to return
</span><span class="cm">     * @param &lt;T&gt; the type of the result
</span><span class="cm">     * @return a Future representing pending completion of the task
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if the task is null
</span><span class="cm">     */</span>
    <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Submits a Runnable task for execution and returns a Future
</span><span class="cm">     * representing that task. The Future&#39;s {@code get} method will
</span><span class="cm">     * return {@code null} upon &lt;em&gt;successful&lt;/em&gt; completion.
</span><span class="cm">     *
</span><span class="cm">     * @param task the task to submit
</span><span class="cm">     * @return a Future representing pending completion of the task
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if the task is null
</span><span class="cm">     */</span>
    <span class="n">Future</span><span class="o">&lt;?&gt;</span> <span class="n">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Executes the given tasks, returning a list of Futures holding
</span><span class="cm">     * their status and results when all complete.
</span><span class="cm">     * {@link Future#isDone} is {@code true} for each
</span><span class="cm">     * element of the returned list.
</span><span class="cm">     * Note that a &lt;em&gt;completed&lt;/em&gt; task could have
</span><span class="cm">     * terminated either normally or by throwing an exception.
</span><span class="cm">     * The results of this method are undefined if the given
</span><span class="cm">     * collection is modified while this operation is in progress.
</span><span class="cm">     *
</span><span class="cm">     * @param tasks the collection of tasks
</span><span class="cm">     * @param &lt;T&gt; the type of the values returned from the tasks
</span><span class="cm">     * @return a list of Futures representing the tasks, in the same
</span><span class="cm">     *         sequential order as produced by the iterator for the
</span><span class="cm">     *         given task list, each of which has completed
</span><span class="cm">     * @throws InterruptedException if interrupted while waiting, in
</span><span class="cm">     *         which case unfinished tasks are cancelled
</span><span class="cm">     * @throws NullPointerException if tasks or any of its elements are {@code null}
</span><span class="cm">     * @throws RejectedExecutionException if any task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     */</span>
    <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">invokeAll</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">tasks</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * Executes the given tasks, returning a list of Futures holding
</span><span class="cm">     * their status and results
</span><span class="cm">     * when all complete or the timeout expires, whichever happens first.
</span><span class="cm">     * {@link Future#isDone} is {@code true} for each
</span><span class="cm">     * element of the returned list.
</span><span class="cm">     * Upon return, tasks that have not completed are cancelled.
</span><span class="cm">     * Note that a &lt;em&gt;completed&lt;/em&gt; task could have
</span><span class="cm">     * terminated either normally or by throwing an exception.
</span><span class="cm">     * The results of this method are undefined if the given
</span><span class="cm">     * collection is modified while this operation is in progress.
</span><span class="cm">     *
</span><span class="cm">     * @param tasks the collection of tasks
</span><span class="cm">     * @param timeout the maximum time to wait
</span><span class="cm">     * @param unit the time unit of the timeout argument
</span><span class="cm">     * @param &lt;T&gt; the type of the values returned from the tasks
</span><span class="cm">     * @return a list of Futures representing the tasks, in the same
</span><span class="cm">     *         sequential order as produced by the iterator for the
</span><span class="cm">     *         given task list. If the operation did not time out,
</span><span class="cm">     *         each task will have completed. If it did time out, some
</span><span class="cm">     *         of these tasks will not have completed.
</span><span class="cm">     * @throws InterruptedException if interrupted while waiting, in
</span><span class="cm">     *         which case unfinished tasks are cancelled
</span><span class="cm">     * @throws NullPointerException if tasks, any of its elements, or
</span><span class="cm">     *         unit are {@code null}
</span><span class="cm">     * @throws RejectedExecutionException if any task cannot be scheduled
</span><span class="cm">     *         for execution
</span><span class="cm">     */</span>
    <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">invokeAll</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">tasks</span><span class="o">,</span>
                                  <span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * Executes the given tasks, returning the result
</span><span class="cm">     * of one that has completed successfully (i.e., without throwing
</span><span class="cm">     * an exception), if any do. Upon normal or exceptional return,
</span><span class="cm">     * tasks that have not completed are cancelled.
</span><span class="cm">     * The results of this method are undefined if the given
</span><span class="cm">     * collection is modified while this operation is in progress.
</span><span class="cm">     *
</span><span class="cm">     * @param tasks the collection of tasks
</span><span class="cm">     * @param &lt;T&gt; the type of the values returned from the tasks
</span><span class="cm">     * @return the result returned by one of the tasks
</span><span class="cm">     * @throws InterruptedException if interrupted while waiting
</span><span class="cm">     * @throws NullPointerException if tasks or any element task
</span><span class="cm">     *         subject to execution is {@code null}
</span><span class="cm">     * @throws IllegalArgumentException if tasks is empty
</span><span class="cm">     * @throws ExecutionException if no task successfully completes
</span><span class="cm">     * @throws RejectedExecutionException if tasks cannot be scheduled
</span><span class="cm">     *         for execution
</span><span class="cm">     */</span>
    <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">invokeAny</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">tasks</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">,</span> <span class="n">ExecutionException</span><span class="o">;</span>

    <span class="cm">/**
</span><span class="cm">     * Executes the given tasks, returning the result
</span><span class="cm">     * of one that has completed successfully (i.e., without throwing
</span><span class="cm">     * an exception), if any do before the given timeout elapses.
</span><span class="cm">     * Upon normal or exceptional return, tasks that have not
</span><span class="cm">     * completed are cancelled.
</span><span class="cm">     * The results of this method are undefined if the given
</span><span class="cm">     * collection is modified while this operation is in progress.
</span><span class="cm">     *
</span><span class="cm">     * @param tasks the collection of tasks
</span><span class="cm">     * @param timeout the maximum time to wait
</span><span class="cm">     * @param unit the time unit of the timeout argument
</span><span class="cm">     * @param &lt;T&gt; the type of the values returned from the tasks
</span><span class="cm">     * @return the result returned by one of the tasks
</span><span class="cm">     * @throws InterruptedException if interrupted while waiting
</span><span class="cm">     * @throws NullPointerException if tasks, or unit, or any element
</span><span class="cm">     *         task subject to execution is {@code null}
</span><span class="cm">     * @throws TimeoutException if the given timeout elapses before
</span><span class="cm">     *         any task successfully completes
</span><span class="cm">     * @throws ExecutionException if no task successfully completes
</span><span class="cm">     * @throws RejectedExecutionException if tasks cannot be scheduled
</span><span class="cm">     *         for execution
</span><span class="cm">     */</span>
    <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">invokeAny</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">tasks</span><span class="o">,</span>
                    <span class="kt">long</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">,</span> <span class="n">ExecutionException</span><span class="o">,</span> <span class="n">TimeoutException</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="executorservice-介绍">ExecutorService 介绍</h3>
<p>ExecutorService 是 java 中对线程池定义的一个接口，在这个接口中定义了和后台任务执行相关的方法</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/20210219-ExecutorService%e7%bb%93%e6%9e%84.png"
        data-srcset="/images/20210219-ExecutorService%e7%bb%93%e6%9e%84.png, /images/20210219-ExecutorService%e7%bb%93%e6%9e%84.png 1.5x, /images/20210219-ExecutorService%e7%bb%93%e6%9e%84.png 2x"
        data-sizes="auto"
        alt="/images/20210219-ExecutorService结构.png"
        title="ExecutorService结构" /></p>
<p>Java API 中对 ExecutorService 接口的实现有两个，分别为 <code>java.util.concurrent.ThreadPoolExecutor</code> 和 <code>java.util.concurrent.ScheduledThreadPoolExecutor</code></p>
<p>ExecutorService 还继承了 Executor 接口（注意区分 Executor 接口和 Executors 工厂类），这个接口里只有一个 execute() 方法，继承树如下</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png"
        data-srcset="/images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png, /images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png 1.5x, /images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png 2x"
        data-sizes="auto"
        alt="/images/20210219-Executor接口继承树.png"
        title="Executor接口继承树" /></p>
<h3 id="executorservice-的创建">ExecutorService 的创建</h3>
<p>创建什么样的 ExecutorService 的实例（即线程池）需要根据具体应用场景而定，不过 java 给我们提供了一个 Executors 工厂类，它可以帮助我们很方便地创建各种类型的 ExecutorService 线程池，Executors 可以创建下面四类线程池</p>
<ul>
<li>newCachedThreadPool: 可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程</li>
<li>newFixedThreadPool: 定长线程池，可控制线程最大并发数，超出的线程会在队列中等待</li>
<li>newScheduledThreadPool: 定长线程池，支持定时及周期性任务的执行</li>
<li>newSingleThreadExecutor: 单线程的线程池，使用唯一的线程执行任务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行</li>
</ul>
<p>这些线程池都是基于线程池类 <code>java.util.concurrent.ThreadPoolExecutor</code> 或 <code>java.util.concurrent.ScheduledThreadPoolExecutor</code> 实现的</p>
<p>代码如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Creates a thread pool that creates new threads as needed, but
</span><span class="cm"> * will reuse previously constructed threads when they are
</span><span class="cm"> * available.  These pools will typically improve the performance
</span><span class="cm"> * of programs that execute many short-lived asynchronous tasks.
</span><span class="cm"> * Calls to {@code execute} will reuse previously constructed
</span><span class="cm"> * threads if available. If no existing thread is available, a new
</span><span class="cm"> * thread will be created and added to the pool. Threads that have
</span><span class="cm"> * not been used for sixty seconds are terminated and removed from
</span><span class="cm"> * the cache. Thus, a pool that remains idle for long enough will
</span><span class="cm"> * not consume any resources. Note that pools with similar
</span><span class="cm"> * properties but different details (for example, timeout parameters)
</span><span class="cm"> * may be created using {@link ThreadPoolExecutor} constructors.
</span><span class="cm"> *
</span><span class="cm"> * @return the newly created thread pool
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ExecutorService</span> <span class="nf">newCachedThreadPool</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">0</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span>
                                  <span class="n">60L</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">,</span>
                                  <span class="k">new</span> <span class="n">SynchronousQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;());</span>
<span class="o">}</span>


<span class="cm">/**
</span><span class="cm"> * Creates a thread pool that reuses a fixed number of threads
</span><span class="cm"> * operating off a shared unbounded queue, using the provided
</span><span class="cm"> * ThreadFactory to create new threads when needed.  At any point,
</span><span class="cm"> * at most {@code nThreads} threads will be active processing
</span><span class="cm"> * tasks.  If additional tasks are submitted when all threads are
</span><span class="cm"> * active, they will wait in the queue until a thread is
</span><span class="cm"> * available.  If any thread terminates due to a failure during
</span><span class="cm"> * execution prior to shutdown, a new one will take its place if
</span><span class="cm"> * needed to execute subsequent tasks.  The threads in the pool will
</span><span class="cm"> * exist until it is explicitly {@link ExecutorService#shutdown
</span><span class="cm"> * shutdown}.
</span><span class="cm"> *
</span><span class="cm"> * @param nThreads the number of threads in the pool
</span><span class="cm"> * @param threadFactory the factory to use when creating new threads
</span><span class="cm"> * @return the newly created thread pool
</span><span class="cm"> * @throws NullPointerException if threadFactory is null
</span><span class="cm"> * @throws IllegalArgumentException if {@code nThreads &lt;= 0}
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ExecutorService</span> <span class="nf">newFixedThreadPool</span><span class="o">(</span><span class="kt">int</span> <span class="n">nThreads</span><span class="o">,</span> <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">nThreads</span><span class="o">,</span> <span class="n">nThreads</span><span class="o">,</span>
                                  <span class="n">0L</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">,</span>
                                  <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;(),</span>
                                  <span class="n">threadFactory</span><span class="o">);</span>
<span class="o">}</span>


<span class="cm">/**
</span><span class="cm"> * Creates a thread pool that can schedule commands to run after a
</span><span class="cm"> * given delay, or to execute periodically.
</span><span class="cm"> * @param corePoolSize the number of threads to keep in the pool,
</span><span class="cm"> * even if they are idle
</span><span class="cm"> * @return a newly created scheduled thread pool
</span><span class="cm"> * @throws IllegalArgumentException if {@code corePoolSize &lt; 0}
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ScheduledExecutorService</span> <span class="nf">newScheduledThreadPool</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">);</span>
<span class="o">}</span>


<span class="cm">/**
</span><span class="cm"> * Creates an Executor that uses a single worker thread operating
</span><span class="cm"> * off an unbounded queue. (Note however that if this single
</span><span class="cm"> * thread terminates due to a failure during execution prior to
</span><span class="cm"> * shutdown, a new one will take its place if needed to execute
</span><span class="cm"> * subsequent tasks.)  Tasks are guaranteed to execute
</span><span class="cm"> * sequentially, and no more than one task will be active at any
</span><span class="cm"> * given time. Unlike the otherwise equivalent
</span><span class="cm"> * {@code newFixedThreadPool(1)} the returned executor is
</span><span class="cm"> * guaranteed not to be reconfigurable to use additional threads.
</span><span class="cm"> *
</span><span class="cm"> * @return the newly created single-threaded Executor
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="n">ExecutorService</span> <span class="nf">newSingleThreadExecutor</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">FinalizableDelegatedExecutorService</span>
        <span class="o">(</span><span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span>
                                <span class="n">0L</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">,</span>
                                <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;()));</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Executors 是一个工厂类，它所有的方法返回都是 ThreadPoolExecutor 、ScheduledThreadPoolExecutor 这两个类的实例。</p>
<h3 id="executorservice-的使用">ExecutorService 的使用</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>

<span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Asynchronous task&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="executorservice-的执行">ExecutorService 的执行</h3>
<p>ExecutorService 有如下几个执行方法</p>
<ul>
<li><code>void execute(Runnable command);</code>  （继承自 Executor）</li>
<li><code>Future&lt;?&gt; submit(Runnable task);</code></li>
<li><code>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);</code></li>
<li><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);</code></li>
<li><code>&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException;</code></li>
<li><code>&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;</code></li>
<li><code>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException;</code></li>
<li><code>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException;</code></li>
</ul>
<h4 id="void-executerunnable-command"><code>void execute(Runnable command);</code></h4>
<p>该方法继承自 Executor 接口，无法获取可运行任务的执行结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Executor</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">     * Executes the given command at some time in the future.  The command
</span><span class="cm">     * may execute in a new thread, in a pooled thread, or in the calling
</span><span class="cm">     * thread, at the discretion of the {@code Executor} implementation.
</span><span class="cm">     *
</span><span class="cm">     * @param command the runnable task
</span><span class="cm">     * @throws RejectedExecutionException if this task cannot be
</span><span class="cm">     * accepted for execution
</span><span class="cm">     * @throws NullPointerException if command is null
</span><span class="cm">     */</span>
    <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>

<span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Asynchronous task&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="future-submitrunnable-task"><code>Future&lt;?&gt; submit(Runnable task);</code></h4>
<p><code>void execute(Runnable command);</code> 与 <code>Future&lt;?&gt; submit(Runnable task);</code> 的区别是后者可以返回一个 Future 对象，通过该 Future 对象，可以检查提交的任务是否执行完毕。</p>
<p>任务执行成功后，会返回 null</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Submits a Runnable task for execution and returns a Future
</span><span class="cm"> * representing that task. The Future&#39;s {@code get} method will
</span><span class="cm"> * return {@code null} upon &lt;em&gt;successful&lt;/em&gt; completion.
</span><span class="cm"> *
</span><span class="cm"> * @param task the task to submit
</span><span class="cm"> * @return a Future representing pending completion of the task
</span><span class="cm"> * @throws RejectedExecutionException if the task cannot be
</span><span class="cm"> *         scheduled for execution
</span><span class="cm"> * @throws NullPointerException if the task is null
</span><span class="cm"> */</span>
<span class="n">Future</span><span class="o">&lt;?&gt;</span> <span class="n">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Future</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Asynchronous task&#34;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>  <span class="c1">//returns null if the task has finished correctly.
</span></code></pre></td></tr></table>
</div>
</div><p>如果任务执行完成，future.get()方法会返回一个null。注意，future.get()方法会产生阻塞。</p>
<h4 id="t-futuret-submitrunnable-task-t-result"><code>&lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result);</code></h4>
<p>该方法和上面的方法相比，可执行的任务成功完成后，可以返回指定类型的返回值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Submits a Runnable task for execution and returns a Future
</span><span class="cm"> * representing that task. The Future&#39;s {@code get} method will
</span><span class="cm"> * return the given result upon successful completion.
</span><span class="cm"> *
</span><span class="cm"> * @param task the task to submit
</span><span class="cm"> * @param result the result to return
</span><span class="cm"> * @param &lt;T&gt; the type of the result
</span><span class="cm"> * @return a Future representing pending completion of the task
</span><span class="cm"> * @throws RejectedExecutionException if the task cannot be
</span><span class="cm"> *         scheduled for execution
</span><span class="cm"> * @throws NullPointerException if the task is null
</span><span class="cm"> */</span>
<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">);</span>
</code></pre></td></tr></table>
</div>
</div><p>Runnable 接口的 run() 方法是没有返回值的，那这个为什么会有返回值呢？看如下代码</p>
<p>java.util.concurrent.AbstractExecutorService#submit(java.lang.Runnable, T)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * @throws RejectedExecutionException {@inheritDoc}
</span><span class="cm"> * @throws NullPointerException       {@inheritDoc}
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">task</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
    <span class="n">RunnableFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">ftask</span> <span class="o">=</span> <span class="n">newTaskFor</span><span class="o">(</span><span class="n">task</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
    <span class="n">execute</span><span class="o">(</span><span class="n">ftask</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">ftask</span><span class="o">;</span>
<span class="o">}</span>


<span class="cm">/**
</span><span class="cm"> * Returns a {@code RunnableFuture} for the given runnable and default
</span><span class="cm"> * value.
</span><span class="cm"> *
</span><span class="cm"> * @param runnable the runnable task being wrapped
</span><span class="cm"> * @param value the default value for the returned future
</span><span class="cm"> * @param &lt;T&gt; the type of the given value
</span><span class="cm"> * @return a {@code RunnableFuture} which, when run, will run the
</span><span class="cm"> * underlying runnable and which, as a {@code Future}, will yield
</span><span class="cm"> * the given value as its result and provide for cancellation of
</span><span class="cm"> * the underlying task
</span><span class="cm"> * @since 1.6
</span><span class="cm"> */</span>
<span class="kd">protected</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">RunnableFuture</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">newTaskFor</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">runnable</span><span class="o">,</span> <span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">FutureTask</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>java.util.concurrent.FutureTask#FutureTask(java.lang.Runnable, V)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Creates a {@code FutureTask} that will, upon running, execute the
</span><span class="cm"> * given {@code Runnable}, and arrange that {@code get} will return the
</span><span class="cm"> * given result on successful completion.
</span><span class="cm"> *
</span><span class="cm"> * @param runnable the runnable task
</span><span class="cm"> * @param result the result to return on successful completion. If
</span><span class="cm"> * you don&#39;t need a particular result, consider using
</span><span class="cm"> * constructions of the form:
</span><span class="cm"> * {@code Future&lt;?&gt; f = new FutureTask&lt;Void&gt;(runnable, null)}
</span><span class="cm"> * @throws NullPointerException if the runnable is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">FutureTask</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">runnable</span><span class="o">,</span> <span class="n">V</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">callable</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">callable</span><span class="o">(</span><span class="n">runnable</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="n">NEW</span><span class="o">;</span>       <span class="c1">// ensure visibility of callable
</span><span class="c1"></span><span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>java.util.concurrent.Executors#callable(java.lang.Runnable, T)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Returns a {@link Callable} object that, when
</span><span class="cm"> * called, runs the given task and returns the given result.  This
</span><span class="cm"> * can be useful when applying methods requiring a
</span><span class="cm"> * {@code Callable} to an otherwise resultless action.
</span><span class="cm"> * @param task the task to run
</span><span class="cm"> * @param result the result to return
</span><span class="cm"> * @param &lt;T&gt; the type of the result
</span><span class="cm"> * @return a callable object
</span><span class="cm"> * @throws NullPointerException if task null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">callable</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">task</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">RunnableAdapter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">task</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
<span class="o">}</span>


<span class="cm">/**
</span><span class="cm"> * A callable that runs given task and returns given result
</span><span class="cm"> */</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">RunnableAdapter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Runnable</span> <span class="n">task</span><span class="o">;</span>
    <span class="kd">final</span> <span class="n">T</span> <span class="n">result</span><span class="o">;</span>
    <span class="n">RunnableAdapter</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">T</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>通过 RunnableAdapter 将 Runnable 实例包装为了 Callable 实例。执行 Runnable 实例的 run 方法时，在 run 方法中将 T 类型的 result 进行修改，然后返回 T 类型的值。</p>
<p>注意： java 对象是引用类型，所以变量 result 和 Runnable 实例中的 对象是一个引用，指向了一块栈内存，在 run 方法里修改了该引用的对象后，result 变量也被修改了。</p>
<p>使用下面的例子便于理解下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">org.msdemt.simple</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.concurrent.Callable</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">RunnableAdapter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Runnable</span> <span class="n">task</span><span class="o">;</span>
        <span class="kd">final</span> <span class="n">T</span> <span class="n">result</span><span class="o">;</span>
        <span class="n">RunnableAdapter</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">T</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">task</span> <span class="o">=</span> <span class="n">task</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="kd">public</span> <span class="n">T</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Data</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Data</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">RunnableAdapter</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span> <span class="n">dataRunnableAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RunnableAdapter</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="n">Task1</span><span class="o">(</span><span class="n">data</span><span class="o">),</span> <span class="n">data</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">dataRunnableAdapter</span><span class="o">.</span><span class="na">call</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Task1</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="n">Data</span> <span class="n">data</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Task1</span><span class="o">(</span><span class="n">Data</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;This is ThreadPoolExetor#submit(Runnable task, T result) method.&#34;</span><span class="o">);</span>
        <span class="n">data</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;kevin&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Submit2</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ExecutionException</span><span class="o">,</span> <span class="n">InterruptedException</span> <span class="o">{</span>

        <span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
        <span class="n">Data</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Data</span><span class="o">();</span>
        <span class="n">Future</span><span class="o">&lt;</span><span class="n">Data</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Task</span><span class="o">(</span><span class="n">data</span><span class="o">),</span> <span class="n">data</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Data</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Task</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
    <span class="n">Data</span> <span class="n">data</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Task</span><span class="o">(</span><span class="n">Data</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;This is ThreadPoolExetor#submit(Runnable task, T result) method.&#34;</span><span class="o">);</span>
        <span class="n">data</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;kevin&#34;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="t-futuret-submitcallablet-task"><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);</code></h4>
<p><code>&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);</code> 也会返回一个 Future 对象，但该方法接受一个 Callable 的实现，Callable 接口中的 call() 方法具有返回值，可以返回任务的执行结果。</p>
<p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Future</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">(){</span>
  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Asynchronous Callable&#34;</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">&#34;Callable Result&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;future.get() = &#34;</span> <span class="o">+</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
</code></pre></td></tr></table>
</div>
</div><p>如果任务执行完成，future.get()方法会返回Callable任务的执行结果。注意，future.get()方法会产生阻塞。</p>
<h4 id="t-t-invokeanycollection-extends-callablet-tasks-throws-interruptedexception-executionexception"><code>&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException;</code></h4>
<p>invokeAny(&hellip;) 方法接收的是一个Callable的集合，执行这个方法不会返回Future，但是会返回所有Callable任务中其中一个任务的执行结果。这个方法也无法保证返回的是哪个任务的执行结果，反正是其中的某一个。</p>
<p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>

<span class="n">Set</span><span class="o">&lt;</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">callables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;();</span>

<span class="n">callables</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;Task 1&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
<span class="n">callables</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;Task 2&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
<span class="n">callables</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;Task 3&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">executorService</span><span class="o">.</span><span class="na">invokeAny</span><span class="o">(</span><span class="n">callables</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;result = &#34;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="t-listfuturet-invokeallcollection-extends-callablet-tasks-throws-interruptedexception"><code>&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException;</code></h4>
<p>invokeAll(&hellip;)与 invokeAny(&hellip;)类似也是接收一个Callable集合，但是前者执行之后会返回一个Future的List，其中对应着每个Callable任务执行后的Future对象。</p>
<p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>

<span class="n">Set</span><span class="o">&lt;</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">callables</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;();</span>

<span class="n">callables</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;Task 1&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
<span class="n">callables</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;Task 2&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>
<span class="n">callables</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">&#34;Task 3&#34;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">});</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span> <span class="n">executorService</span><span class="o">.</span><span class="na">invokeAll</span><span class="o">(</span><span class="n">callables</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">:</span> <span class="n">futures</span><span class="o">){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;future.get = &#34;</span> <span class="o">+</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="o">}</span>

<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="executorservice-的关闭">ExecutorService 的关闭</h3>
<p>当我们使用完成ExecutorService之后应该关闭它，否则它里面的线程会一直处于运行状态。</p>
<p>举个例子，如果的应用程序是通过main()方法启动的，在这个main()退出之后，如果应用程序中的ExecutorService没有关闭，这个应用将一直运行。之所以会出现这种情况，是因为ExecutorService中运行的线程会阻止JVM关闭。</p>
<p>如果要关闭ExecutorService中执行的线程，我们可以调用ExecutorService.shutdown()方法。在调用shutdown()方法之后，ExecutorService不会立即关闭，但是它不再接收新的任务，直到当前所有线程执行完成才会关闭，所有在shutdown()执行之前提交的任务都会被执行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Initiates an orderly shutdown in which previously submitted
</span><span class="cm"> * tasks are executed, but no new tasks will be accepted.
</span><span class="cm"> * Invocation has no additional effect if already shut down.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;This method does not wait for previously submitted tasks to
</span><span class="cm"> * complete execution.  Use {@link #awaitTermination awaitTermination}
</span><span class="cm"> * to do that.
</span><span class="cm"> *
</span><span class="cm"> * @throws SecurityException if a security manager exists and
</span><span class="cm"> *         shutting down this ExecutorService may manipulate
</span><span class="cm"> *         threads that the caller is not permitted to modify
</span><span class="cm"> *         because it does not hold {@link
</span><span class="cm"> *         java.lang.RuntimePermission}{@code (&#34;modifyThread&#34;)},
</span><span class="cm"> *         or the security manager&#39;s {@code checkAccess} method
</span><span class="cm"> *         denies access.
</span><span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><p>如果我们想立即关闭ExecutorService，我们可以调用ExecutorService.shutdownNow()方法。这个动作将跳过所有正在执行的任务和被提交还没有执行的任务。但是它并不对正在执行的任务做任何保证，有可能它们都会停止，也有可能执行完成。 shutdownNow() 会返回未被执行过的任务列表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Attempts to stop all actively executing tasks, halts the
</span><span class="cm"> * processing of waiting tasks, and returns a list of the tasks
</span><span class="cm"> * that were awaiting execution.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;This method does not wait for actively executing tasks to
</span><span class="cm"> * terminate.  Use {@link #awaitTermination awaitTermination} to
</span><span class="cm"> * do that.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;There are no guarantees beyond best-effort attempts to stop
</span><span class="cm"> * processing actively executing tasks.  For example, typical
</span><span class="cm"> * implementations will cancel via {@link Thread#interrupt}, so any
</span><span class="cm"> * task that fails to respond to interrupts may never terminate.
</span><span class="cm"> *
</span><span class="cm"> * @return list of tasks that never commenced execution
</span><span class="cm"> * @throws SecurityException if a security manager exists and
</span><span class="cm"> *         shutting down this ExecutorService may manipulate
</span><span class="cm"> *         threads that the caller is not permitted to modify
</span><span class="cm"> *         because it does not hold {@link
</span><span class="cm"> *         java.lang.RuntimePermission}{@code (&#34;modifyThread&#34;)},
</span><span class="cm"> *         or the security manager&#39;s {@code checkAccess} method
</span><span class="cm"> *         denies access.
</span><span class="cm"> */</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="nf">shutdownNow</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="java-线程池类">java 线程池类</h2>
<p>Java Api 中提供的线程池类有两个，分别是 <code>java.util.concurrent.ThreadPoolExecutor</code> 和 <code>java.util.concurrent.ScheduledThreadPoolExecutor</code> ，利用这两个类，可以自定义各种不同的 Java 线程池。</p>
<p>为了方便我们创建线程池， Java API 提供了 Executors 工厂类帮助我们创建各种线程池，如 newFixedThreadPool 、newScheduledThreadPool 等。</p>
<p>Java 线程池 ExecutorService 继承树结构如下</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png"
        data-srcset="/images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png, /images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png 1.5x, /images/20210219-Executor%e6%8e%a5%e5%8f%a3%e7%bb%a7%e6%89%bf%e6%a0%91.png 2x"
        data-sizes="auto"
        alt="/images/20210219-Executor接口继承树.png"
        title="Executor接口继承树" /></p>
<h3 id="threadpoolexecutor">ThreadPoolExecutor</h3>
<p>ThreadPoolExecutor是ExecutorService的一个实现类，也是java中最常用的线程池类。ThreadPoolExecutor内部维持了一个线程池，可以执行给定的任务。</p>
<h4 id="threadpoolexecutor-构造方法及作用">ThreadPoolExecutor 构造方法及作用</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * Creates a new {@code ThreadPoolExecutor} with the given initial
</span><span class="cm"> * parameters and default thread factory and rejected execution handler.
</span><span class="cm"> * It may be more convenient to use one of the {@link Executors} factory
</span><span class="cm"> * methods instead of this general purpose constructor.
</span><span class="cm"> *
</span><span class="cm"> * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm"> *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm"> * @param maximumPoolSize the maximum number of threads to allow in the
</span><span class="cm"> *        pool
</span><span class="cm"> * @param keepAliveTime when the number of threads is greater than
</span><span class="cm"> *        the core, this is the maximum time that excess idle threads
</span><span class="cm"> *        will wait for new tasks before terminating.
</span><span class="cm"> * @param unit the time unit for the {@code keepAliveTime} argument
</span><span class="cm"> * @param workQueue the queue to use for holding tasks before they are
</span><span class="cm"> *        executed.  This queue will hold only the {@code Runnable}
</span><span class="cm"> *        tasks submitted by the {@code execute} method.
</span><span class="cm"> * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;
</span><span class="cm"> *         {@code corePoolSize &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code keepAliveTime &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt;= 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt; corePoolSize}
</span><span class="cm"> * @throws NullPointerException if {@code workQueue} is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">maximumPoolSize</span><span class="o">,</span> <span class="n">keepAliveTime</span><span class="o">,</span> <span class="n">unit</span><span class="o">,</span> <span class="n">workQueue</span><span class="o">,</span>
         <span class="n">Executors</span><span class="o">.</span><span class="na">defaultThreadFactory</span><span class="o">(),</span> <span class="n">defaultHandler</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * Creates a new {@code ThreadPoolExecutor} with the given initial
</span><span class="cm"> * parameters and default rejected execution handler.
</span><span class="cm"> *
</span><span class="cm"> * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm"> *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm"> * @param maximumPoolSize the maximum number of threads to allow in the
</span><span class="cm"> *        pool
</span><span class="cm"> * @param keepAliveTime when the number of threads is greater than
</span><span class="cm"> *        the core, this is the maximum time that excess idle threads
</span><span class="cm"> *        will wait for new tasks before terminating.
</span><span class="cm"> * @param unit the time unit for the {@code keepAliveTime} argument
</span><span class="cm"> * @param workQueue the queue to use for holding tasks before they are
</span><span class="cm"> *        executed.  This queue will hold only the {@code Runnable}
</span><span class="cm"> *        tasks submitted by the {@code execute} method.
</span><span class="cm"> * @param threadFactory the factory to use when the executor
</span><span class="cm"> *        creates a new thread
</span><span class="cm"> * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;
</span><span class="cm"> *         {@code corePoolSize &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code keepAliveTime &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt;= 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt; corePoolSize}
</span><span class="cm"> * @throws NullPointerException if {@code workQueue}
</span><span class="cm"> *         or {@code threadFactory} is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
                          <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">maximumPoolSize</span><span class="o">,</span> <span class="n">keepAliveTime</span><span class="o">,</span> <span class="n">unit</span><span class="o">,</span> <span class="n">workQueue</span><span class="o">,</span>
         <span class="n">threadFactory</span><span class="o">,</span> <span class="n">defaultHandler</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * Creates a new {@code ThreadPoolExecutor} with the given initial
</span><span class="cm"> * parameters and default thread factory.
</span><span class="cm"> *
</span><span class="cm"> * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm"> *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm"> * @param maximumPoolSize the maximum number of threads to allow in the
</span><span class="cm"> *        pool
</span><span class="cm"> * @param keepAliveTime when the number of threads is greater than
</span><span class="cm"> *        the core, this is the maximum time that excess idle threads
</span><span class="cm"> *        will wait for new tasks before terminating.
</span><span class="cm"> * @param unit the time unit for the {@code keepAliveTime} argument
</span><span class="cm"> * @param workQueue the queue to use for holding tasks before they are
</span><span class="cm"> *        executed.  This queue will hold only the {@code Runnable}
</span><span class="cm"> *        tasks submitted by the {@code execute} method.
</span><span class="cm"> * @param handler the handler to use when execution is blocked
</span><span class="cm"> *        because the thread bounds and queue capacities are reached
</span><span class="cm"> * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;
</span><span class="cm"> *         {@code corePoolSize &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code keepAliveTime &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt;= 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt; corePoolSize}
</span><span class="cm"> * @throws NullPointerException if {@code workQueue}
</span><span class="cm"> *         or {@code handler} is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
                          <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">maximumPoolSize</span><span class="o">,</span> <span class="n">keepAliveTime</span><span class="o">,</span> <span class="n">unit</span><span class="o">,</span> <span class="n">workQueue</span><span class="o">,</span>
         <span class="n">Executors</span><span class="o">.</span><span class="na">defaultThreadFactory</span><span class="o">(),</span> <span class="n">handler</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
</span><span class="cm"> * Creates a new {@code ThreadPoolExecutor} with the given initial
</span><span class="cm"> * parameters.
</span><span class="cm"> *
</span><span class="cm"> * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm"> *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm"> * @param maximumPoolSize the maximum number of threads to allow in the
</span><span class="cm"> *        pool
</span><span class="cm"> * @param keepAliveTime when the number of threads is greater than
</span><span class="cm"> *        the core, this is the maximum time that excess idle threads
</span><span class="cm"> *        will wait for new tasks before terminating.
</span><span class="cm"> * @param unit the time unit for the {@code keepAliveTime} argument
</span><span class="cm"> * @param workQueue the queue to use for holding tasks before they are
</span><span class="cm"> *        executed.  This queue will hold only the {@code Runnable}
</span><span class="cm"> *        tasks submitted by the {@code execute} method.
</span><span class="cm"> * @param threadFactory the factory to use when the executor
</span><span class="cm"> *        creates a new thread
</span><span class="cm"> * @param handler the handler to use when execution is blocked
</span><span class="cm"> *        because the thread bounds and queue capacities are reached
</span><span class="cm"> * @throws IllegalArgumentException if one of the following holds:&lt;br&gt;
</span><span class="cm"> *         {@code corePoolSize &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code keepAliveTime &lt; 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt;= 0}&lt;br&gt;
</span><span class="cm"> *         {@code maximumPoolSize &lt; corePoolSize}
</span><span class="cm"> * @throws NullPointerException if {@code workQueue}
</span><span class="cm"> *         or {@code threadFactory} or {@code handler} is null
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="nf">ThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                          <span class="kt">int</span> <span class="n">maximumPoolSize</span><span class="o">,</span>
                          <span class="kt">long</span> <span class="n">keepAliveTime</span><span class="o">,</span>
                          <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">,</span>
                          <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">workQueue</span><span class="o">,</span>
                          <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">,</span>
                          <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">corePoolSize</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">||</span>
        <span class="n">maximumPoolSize</span> <span class="o">&lt;=</span> <span class="n">0</span> <span class="o">||</span>
        <span class="n">maximumPoolSize</span> <span class="o">&lt;</span> <span class="n">corePoolSize</span> <span class="o">||</span>
        <span class="n">keepAliveTime</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">();</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">workQueue</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">threadFactory</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">handler</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">NullPointerException</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">acc</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getSecurityManager</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span>
            <span class="kc">null</span> <span class="o">:</span>
            <span class="n">AccessController</span><span class="o">.</span><span class="na">getContext</span><span class="o">();</span>
    <span class="k">this</span><span class="o">.</span><span class="na">corePoolSize</span> <span class="o">=</span> <span class="n">corePoolSize</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">maximumPoolSize</span> <span class="o">=</span> <span class="n">maximumPoolSize</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">workQueue</span> <span class="o">=</span> <span class="n">workQueue</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">keepAliveTime</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="na">toNanos</span><span class="o">(</span><span class="n">keepAliveTime</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">threadFactory</span> <span class="o">=</span> <span class="n">threadFactory</span><span class="o">;</span>
    <span class="k">this</span><span class="o">.</span><span class="na">handler</span> <span class="o">=</span> <span class="n">handler</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>corePoolSize: 线程池维护线程的最少数量</li>
<li>maximumPoolSize: 线程池维护线程的最大数量</li>
<li>keepAliveTime: 线程池维护线程所允许的空闲时间</li>
<li>unit: 线程池维护线程所允许的空闲时间的单位</li>
<li>workQueue: 线程池所使用的缓冲队列</li>
<li>threadFactory: 线程创建工厂</li>
<li>handler: 线程池对拒绝任务的处理策略</li>
</ul>
<h4 id="线程数量控制">线程数量控制</h4>
<p>ThreadPoolExecutor线程池中的线程数量是可变的，其变化范围取决于下面两个变量</p>
<ul>
<li>corePoolSize：线程池维护线程的最少数量</li>
<li>maximumPoolSize：线程池维护线程的最大数量</li>
</ul>
<p>当一个任务被添加到线程池</p>
<ul>
<li>如果此时线程池中的数量小于corePoolSize，即使线程池中的线程都处于空闲状态，也要创建新的线程来处理被添加的任务。</li>
<li>如果此时线程池中的数量等于 corePoolSize，但是缓冲队列 workQueue未满，那么任务被放入缓冲队列。</li>
<li>如果此时线程池中的数量大于corePoolSize，缓冲队列workQueue满，并且线程池中的数量小于maximumPoolSize，建新的线程来处理被添加的任务。</li>
<li>如果此时线程池中的数量大于corePoolSize，缓冲队列workQueue满，并且线程池中的数量等于maximumPoolSize，那么通过 handler所指定的策略来处理此任务。也就是：处理任务的优先级为：核心线程corePoolSize、任务队列workQueue、最大线程maximumPoolSize，如果三者都满了，使用handler处理被拒绝的任务。</li>
<li>当线程池中的线程数量大于 corePoolSize时，如果某线程空闲时间超过keepAliveTime，线程将被终止。</li>
</ul>
<h4 id="unit">unit</h4>
<p>unit 可选的参数为java.util.concurrent.TimeUnit中的几个静态属性</p>
<ul>
<li>NANOSECONDS 纳秒</li>
<li>MICROSECONDS 微秒</li>
<li>MILLISECONDS 毫秒</li>
<li>SECONDS 秒</li>
</ul>
<h4 id="workqueue">workQueue</h4>
<p>workQueue是一个BlockingQueue，默认是<code>LinkedBlockingQueue&lt;Runnable&gt;</code></p>
<h4 id="handler">handler</h4>
<p>handler 是线程池拒绝处理任务的方式，主要有四种类型</p>
<ul>
<li>ThreadPoolExecutor.AbortPolicy()（系统默认）：抛出java.util.concurrent.RejectedExecutionException异常</li>
<li>ThreadPoolExecutor.CallerRunsPolicy()：当抛出RejectedExecutionException异常时，会调用rejectedExecution方法</li>
<li>ThreadPoolExecutor.DiscardOldestPolicy()：抛弃旧的任务</li>
<li>ThreadPoolExecutor.DiscardPolicy()：抛弃当前的任务</li>
</ul>
<h4 id="创建一个threadpoolexecutor">创建一个ThreadPoolExecutor</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span>  <span class="n">corePoolSize</span>  <span class="o">=</span>    <span class="n">5</span><span class="o">;</span>
<span class="kt">int</span>  <span class="n">maxPoolSize</span>   <span class="o">=</span>   <span class="n">10</span><span class="o">;</span>
<span class="kt">long</span> <span class="n">keepAliveTime</span> <span class="o">=</span> <span class="n">5000</span><span class="o">;</span>

<span class="n">ExecutorService</span> <span class="n">threadPoolExecutor</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">ThreadPoolExecutor</span><span class="o">(</span>
            <span class="n">corePoolSize</span><span class="o">,</span>
            <span class="n">maxPoolSize</span><span class="o">,</span>
            <span class="n">keepAliveTime</span><span class="o">,</span>
            <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">,</span>
                <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;()</span>
            <span class="o">);</span>

</code></pre></td></tr></table>
</div>
</div><h3 id="scheduledthreadpoolexecutor">ScheduledThreadPoolExecutor</h3>
<p>ScheduledThreadPoolExecutor是ExecutorService的另一个实现类。</p>
<p>从上面Java线程池ExecutorService继承树这幅图可以看出，ScheduledThreadPoolExecutor直接继承自ScheduledExecutorService。</p>
<p>ScheduledThreadPoolExecutor 类的功能也主要体现在ScheduledExecutorService 接口上，而所以在介绍ScheduledThreadPoolExecutor之前先介绍一下ScheduledExecutorService接口。</p>
<h4 id="scheduledexecutorservice接口介绍">ScheduledExecutorService接口介绍</h4>
<p><code>java.util.concurrent.ScheduledExecutorService</code>接口继承了ExecutorService，它的最主要的功能就是可以对其中的任务进行调度，比如延迟执行、定时执行等等。</p>
<p>ScheduledExecutorService接口定义：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*
</span><span class="cm"> * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> */</span>

<span class="cm">/*
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> *
</span><span class="cm"> * Written by Doug Lea with assistance from members of JCP JSR-166
</span><span class="cm"> * Expert Group and released to the public domain, as explained at
</span><span class="cm"> * http://creativecommons.org/publicdomain/zero/1.0/
</span><span class="cm"> */</span>

<span class="kn">package</span> <span class="nn">java.util.concurrent</span><span class="o">;</span>

<span class="cm">/**
</span><span class="cm"> * An {@link ExecutorService} that can schedule commands to run after a given
</span><span class="cm"> * delay, or to execute periodically.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;The {@code schedule} methods create tasks with various delays
</span><span class="cm"> * and return a task object that can be used to cancel or check
</span><span class="cm"> * execution. The {@code scheduleAtFixedRate} and
</span><span class="cm"> * {@code scheduleWithFixedDelay} methods create and execute tasks
</span><span class="cm"> * that run periodically until cancelled.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;Commands submitted using the {@link Executor#execute(Runnable)}
</span><span class="cm"> * and {@link ExecutorService} {@code submit} methods are scheduled
</span><span class="cm"> * with a requested delay of zero. Zero and negative delays (but not
</span><span class="cm"> * periods) are also allowed in {@code schedule} methods, and are
</span><span class="cm"> * treated as requests for immediate execution.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;All {@code schedule} methods accept &lt;em&gt;relative&lt;/em&gt; delays and
</span><span class="cm"> * periods as arguments, not absolute times or dates. It is a simple
</span><span class="cm"> * matter to transform an absolute time represented as a {@link
</span><span class="cm"> * java.util.Date} to the required form. For example, to schedule at
</span><span class="cm"> * a certain future {@code date}, you can use: {@code schedule(task,
</span><span class="cm"> * date.getTime() - System.currentTimeMillis(),
</span><span class="cm"> * TimeUnit.MILLISECONDS)}. Beware however that expiration of a
</span><span class="cm"> * relative delay need not coincide with the current {@code Date} at
</span><span class="cm"> * which the task is enabled due to network time synchronization
</span><span class="cm"> * protocols, clock drift, or other factors.
</span><span class="cm"> *
</span><span class="cm"> * &lt;p&gt;The {@link Executors} class provides convenient factory methods for
</span><span class="cm"> * the ScheduledExecutorService implementations provided in this package.
</span><span class="cm"> *
</span><span class="cm"> * &lt;h3&gt;Usage Example&lt;/h3&gt;
</span><span class="cm"> *
</span><span class="cm"> * Here is a class with a method that sets up a ScheduledExecutorService
</span><span class="cm"> * to beep every ten seconds for an hour:
</span><span class="cm"> *
</span><span class="cm"> *  &lt;pre&gt; {@code
</span><span class="cm"> * import static java.util.concurrent.TimeUnit.*;
</span><span class="cm"> * class BeeperControl {
</span><span class="cm"> *   private final ScheduledExecutorService scheduler =
</span><span class="cm"> *     Executors.newScheduledThreadPool(1);
</span><span class="cm"> *
</span><span class="cm"> *   public void beepForAnHour() {
</span><span class="cm"> *     final Runnable beeper = new Runnable() {
</span><span class="cm"> *       public void run() { System.out.println(&#34;beep&#34;); }
</span><span class="cm"> *     };
</span><span class="cm"> *     final ScheduledFuture&lt;?&gt; beeperHandle =
</span><span class="cm"> *       scheduler.scheduleAtFixedRate(beeper, 10, 10, SECONDS);
</span><span class="cm"> *     scheduler.schedule(new Runnable() {
</span><span class="cm"> *       public void run() { beeperHandle.cancel(true); }
</span><span class="cm"> *     }, 60 * 60, SECONDS);
</span><span class="cm"> *   }
</span><span class="cm"> * }}&lt;/pre&gt;
</span><span class="cm"> *
</span><span class="cm"> * @since 1.5
</span><span class="cm"> * @author Doug Lea
</span><span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ScheduledExecutorService</span> <span class="kd">extends</span> <span class="n">ExecutorService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Creates and executes a one-shot action that becomes enabled
</span><span class="cm">     * after the given delay.
</span><span class="cm">     *
</span><span class="cm">     * @param command the task to execute
</span><span class="cm">     * @param delay the time from now to delay execution
</span><span class="cm">     * @param unit the time unit of the delay parameter
</span><span class="cm">     * @return a ScheduledFuture representing pending completion of
</span><span class="cm">     *         the task and whose {@code get()} method will return
</span><span class="cm">     *         {@code null} upon completion
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if command is null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">schedule</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span>
                                       <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Creates and executes a ScheduledFuture that becomes enabled after the
</span><span class="cm">     * given delay.
</span><span class="cm">     *
</span><span class="cm">     * @param callable the function to execute
</span><span class="cm">     * @param delay the time from now to delay execution
</span><span class="cm">     * @param unit the time unit of the delay parameter
</span><span class="cm">     * @param &lt;V&gt; the type of the callable&#39;s result
</span><span class="cm">     * @return a ScheduledFuture that can be used to extract result or cancel
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if callable is null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">ScheduledFuture</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">schedule</span><span class="o">(</span><span class="n">Callable</span><span class="o">&lt;</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">callable</span><span class="o">,</span>
                                           <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span> <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Creates and executes a periodic action that becomes enabled first
</span><span class="cm">     * after the given initial delay, and subsequently with the given
</span><span class="cm">     * period; that is executions will commence after
</span><span class="cm">     * {@code initialDelay} then {@code initialDelay+period}, then
</span><span class="cm">     * {@code initialDelay + 2 * period}, and so on.
</span><span class="cm">     * If any execution of the task
</span><span class="cm">     * encounters an exception, subsequent executions are suppressed.
</span><span class="cm">     * Otherwise, the task will only terminate via cancellation or
</span><span class="cm">     * termination of the executor.  If any execution of this task
</span><span class="cm">     * takes longer than its period, then subsequent executions
</span><span class="cm">     * may start late, but will not concurrently execute.
</span><span class="cm">     *
</span><span class="cm">     * @param command the task to execute
</span><span class="cm">     * @param initialDelay the time to delay first execution
</span><span class="cm">     * @param period the period between successive executions
</span><span class="cm">     * @param unit the time unit of the initialDelay and period parameters
</span><span class="cm">     * @return a ScheduledFuture representing pending completion of
</span><span class="cm">     *         the task, and whose {@code get()} method will throw an
</span><span class="cm">     *         exception upon cancellation
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if command is null
</span><span class="cm">     * @throws IllegalArgumentException if period less than or equal to zero
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleAtFixedRate</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span>
                                                  <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span>
                                                  <span class="kt">long</span> <span class="n">period</span><span class="o">,</span>
                                                  <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>

    <span class="cm">/**
</span><span class="cm">     * Creates and executes a periodic action that becomes enabled first
</span><span class="cm">     * after the given initial delay, and subsequently with the
</span><span class="cm">     * given delay between the termination of one execution and the
</span><span class="cm">     * commencement of the next.  If any execution of the task
</span><span class="cm">     * encounters an exception, subsequent executions are suppressed.
</span><span class="cm">     * Otherwise, the task will only terminate via cancellation or
</span><span class="cm">     * termination of the executor.
</span><span class="cm">     *
</span><span class="cm">     * @param command the task to execute
</span><span class="cm">     * @param initialDelay the time to delay first execution
</span><span class="cm">     * @param delay the delay between the termination of one
</span><span class="cm">     * execution and the commencement of the next
</span><span class="cm">     * @param unit the time unit of the initialDelay and delay parameters
</span><span class="cm">     * @return a ScheduledFuture representing pending completion of
</span><span class="cm">     *         the task, and whose {@code get()} method will throw an
</span><span class="cm">     *         exception upon cancellation
</span><span class="cm">     * @throws RejectedExecutionException if the task cannot be
</span><span class="cm">     *         scheduled for execution
</span><span class="cm">     * @throws NullPointerException if command is null
</span><span class="cm">     * @throws IllegalArgumentException if delay less than or equal to zero
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">scheduleWithFixedDelay</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">command</span><span class="o">,</span>
                                                     <span class="kt">long</span> <span class="n">initialDelay</span><span class="o">,</span>
                                                     <span class="kt">long</span> <span class="n">delay</span><span class="o">,</span>
                                                     <span class="n">TimeUnit</span> <span class="n">unit</span><span class="o">);</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>从上面接口定义我们知道，提供了四个方法</p>
<ul>
<li>schedule (Runnable task, long delay, TimeUnit timeunit)</li>
<li>schedule (Callable task, long delay, TimeUnit timeunit)</li>
<li>scheduleAtFixedRate (Runnable, long initialDelay, long period, TimeUnit timeunit)</li>
<li>scheduleWithFixedDelay (Runnable, long initialDelay, long period, TimeUnit timeunit)</li>
</ul>
<h5 id="schedule-runnable-task-long-delay-timeunit-timeunit">schedule (Runnable task, long delay, TimeUnit timeunit)</h5>
<p>这个方法的意思是在指定延迟之后运行task。该方法无法获取task的执行结果。</p>
<p>如果我们想获得task的执行结果，我们可以使用 <code>schedule (Callable task, long delay, TimeUnit timeunit)</code></p>
<p>示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ScheduledExecutorService</span> <span class="n">scheduledExecutorService</span> <span class="o">=</span>
    <span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>

<span class="n">ScheduledFuture</span> <span class="n">scheduledFuture</span> <span class="o">=</span>
  <span class="n">scheduledExecutorService</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Executed!&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;Called!&#34;</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">5</span><span class="o">,</span>
  <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;result = &#34;</span> <span class="o">+</span> <span class="n">scheduledFuture</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>

<span class="n">scheduledExecutorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="schedule-callable-task-long-delay-timeunit-timeunit">schedule (Callable task, long delay, TimeUnit timeunit)</h5>
<p>在指定延迟之后运行task，不过它接收的是一个Callable实例，此方法会返回一个ScheduleFuture对象，通过ScheduleFuture我们可以取消一个未执行的task，也可以获得这个task的执行结果。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">ScheduledExecutorService</span> <span class="n">scheduledExecutorService</span> <span class="o">=</span>
    <span class="n">Executors</span><span class="o">.</span><span class="na">newScheduledThreadPool</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>

<span class="n">ScheduledFuture</span> <span class="n">scheduledFuture</span> <span class="o">=</span>
  <span class="n">scheduledExecutorService</span><span class="o">.</span><span class="na">schedule</span><span class="o">(</span><span class="k">new</span> <span class="n">Callable</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">call</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Executed!&#34;</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">&#34;Called!&#34;</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">},</span>
  <span class="n">5</span><span class="o">,</span>
  <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;result = &#34;</span> <span class="o">+</span> <span class="n">scheduledFuture</span><span class="o">.</span><span class="na">get</span><span class="o">());</span>
<span class="n">scheduledExecutorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="scheduleatfixedrate-runnable-long-initialdelay-long-period-timeunit-timeunit">scheduleAtFixedRate (Runnable, long initialDelay, long period, TimeUnit timeunit)</h5>
<p>这个方法的作用是周期性的调度task执行。task第一次执行的延迟根据initialDelay参数确定，以后每一次执行都间隔period时长。</p>
<p>如果task的执行时间大于定义的period，那么下一个线程将在当前线程完成之后再执行。整个调度保证不会出现一个以上任务同时执行。</p>
<h5 id="schedulewithfixeddelay-runnable-long-initialdelay-long-period-timeunit-timeunit">scheduleWithFixedDelay (Runnable, long initialDelay, long period, TimeUnit timeunit)</h5>
<p>scheduleWithFixedDelay的参数和scheduleAtFixedRate参数完全一致，它们的不同之处在于对period调度周期的解释。</p>
<p>在scheduleAtFixedRate中，period指的两个任务开始执行的时间间隔，也就是当前任务的开始执行时间和下个任务的开始执行时间之间的间隔。</p>
<p>而在scheduleWithFixedDelay中，period指的当前任务的结束执行时间到下个任务的开始执行时间。</p>
<h5 id="scheduledexecutorservice的关闭">ScheduledExecutorService的关闭</h5>
<p>和ExecutorService类似, 我们在使用完ScheduledExecutorService时需要关闭它。如果不关闭的话，JVM会一直运行直，即使所有线程已经关闭了。</p>
<p>关闭ScheduledExecutorService可以使用其继承自ExecutorService接口的shutdown()和shutdownNow()方法</p>
<h4 id="scheduledthreadpoolexecutor-1">ScheduledThreadPoolExecutor</h4>
<p>ScheduledThreadPoolExecutor继承自ThreadPoolExecutor</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ScheduledThreadPoolExecutor</span>
        <span class="kd">extends</span> <span class="n">ThreadPoolExecutor</span>
        <span class="kd">implements</span> <span class="n">ScheduledExecutorService</span> <span class="o">{</span>

    <span class="cm">/**
</span><span class="cm">     * Creates a new {@code ScheduledThreadPoolExecutor} with the
</span><span class="cm">     * given core pool size.
</span><span class="cm">     *
</span><span class="cm">     * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm">     *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm">     * @throws IllegalArgumentException if {@code corePoolSize &lt; 0}
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">NANOSECONDS</span><span class="o">,</span>
              <span class="k">new</span> <span class="n">DelayedWorkQueue</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * Creates a new {@code ScheduledThreadPoolExecutor} with the
</span><span class="cm">     * given initial parameters.
</span><span class="cm">     *
</span><span class="cm">     * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm">     *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm">     * @param threadFactory the factory to use when the executor
</span><span class="cm">     *        creates a new thread
</span><span class="cm">     * @throws IllegalArgumentException if {@code corePoolSize &lt; 0}
</span><span class="cm">     * @throws NullPointerException if {@code threadFactory} is null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                                       <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">NANOSECONDS</span><span class="o">,</span>
              <span class="k">new</span> <span class="n">DelayedWorkQueue</span><span class="o">(),</span> <span class="n">threadFactory</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * Creates a new ScheduledThreadPoolExecutor with the given
</span><span class="cm">     * initial parameters.
</span><span class="cm">     *
</span><span class="cm">     * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm">     *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm">     * @param handler the handler to use when execution is blocked
</span><span class="cm">     *        because the thread bounds and queue capacities are reached
</span><span class="cm">     * @throws IllegalArgumentException if {@code corePoolSize &lt; 0}
</span><span class="cm">     * @throws NullPointerException if {@code handler} is null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                                       <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">NANOSECONDS</span><span class="o">,</span>
              <span class="k">new</span> <span class="n">DelayedWorkQueue</span><span class="o">(),</span> <span class="n">handler</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">     * Creates a new ScheduledThreadPoolExecutor with the given
</span><span class="cm">     * initial parameters.
</span><span class="cm">     *
</span><span class="cm">     * @param corePoolSize the number of threads to keep in the pool, even
</span><span class="cm">     *        if they are idle, unless {@code allowCoreThreadTimeOut} is set
</span><span class="cm">     * @param threadFactory the factory to use when the executor
</span><span class="cm">     *        creates a new thread
</span><span class="cm">     * @param handler the handler to use when execution is blocked
</span><span class="cm">     *        because the thread bounds and queue capacities are reached
</span><span class="cm">     * @throws IllegalArgumentException if {@code corePoolSize &lt; 0}
</span><span class="cm">     * @throws NullPointerException if {@code threadFactory} or
</span><span class="cm">     *         {@code handler} is null
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">ScheduledThreadPoolExecutor</span><span class="o">(</span><span class="kt">int</span> <span class="n">corePoolSize</span><span class="o">,</span>
                                       <span class="n">ThreadFactory</span> <span class="n">threadFactory</span><span class="o">,</span>
                                       <span class="n">RejectedExecutionHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">corePoolSize</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">NANOSECONDS</span><span class="o">,</span>
              <span class="k">new</span> <span class="n">DelayedWorkQueue</span><span class="o">(),</span> <span class="n">threadFactory</span><span class="o">,</span> <span class="n">handler</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>corePoolSize: 线程池维护线程的最少数量</li>
<li>threadFactory: 线程创建工厂类</li>
<li>handler： 线程池对拒绝任务的处理策略</li>
</ul>
<p>具体使用方法参考ThreadPoolExecutor或者使用Executors。</p>
<h3 id="executors">Executors</h3>
<p>创建一个什么样的ExecutorService的实例（即线程池）需要我们的具体应用场景而定，不过Java给我们提供了一个Executors工厂类，它可以帮助我们很方便的创建各种类型ExecutorService线程池，Executors一共可以创建下面这四类线程池：</p>
<ul>
<li>newCachedThreadPool 创建一个可缓存线程池，如果线程池长度超过处理需要，可灵活回收空闲线程，若无可回收，则新建线程。</li>
<li>newFixedThreadPool 创建一个定长线程池，可控制线程最大并发数，超出的线程会在队列中等待。</li>
<li>newScheduledThreadPool 创建一个定长线程池，支持定时及周期性任务执行。</li>
<li>newSingleThreadExecutor 创建一个单线程化的线程池，它只会用唯一的工作线程来执行任务，保证所有任务按照指定顺序(FIFO, LIFO, 优先级)执行。</li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-02-18</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/" data-title="Java线程API"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/" data-title="Java线程API"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/" data-title="Java线程API"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/java%E7%BA%BF%E7%A8%8Bapi/" data-title="Java线程API" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/springboot&#43;netty&#43;websocket%E5%AE%9E%E7%8E%B0%E6%B6%88%E6%81%AF%E6%8E%A8%E9%80%81/" class="prev" rel="prev" title="Springboot&#43;netty&#43;websocket实现消息推送"><i class="fas fa-angle-left fa-fw"></i>Springboot&#43;netty&#43;websocket实现消息推送</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">xxxx</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.zh-cn","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
