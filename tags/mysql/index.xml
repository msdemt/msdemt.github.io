<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>mysql on 何凯的博客</title>
        <link>https://msdemt.github.io/tags/mysql/</link>
        <description>Recent content in mysql on 何凯的博客</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Fri, 11 Aug 2023 00:00:00 +0000</lastBuildDate><atom:link href="https://msdemt.github.io/tags/mysql/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>H2 迁移到 MySQL 问题</title>
        <link>https://msdemt.github.io/p/h2-to-mysql/</link>
        <pubDate>Fri, 11 Aug 2023 00:00:00 +0000</pubDate>
        
        <guid>https://msdemt.github.io/p/h2-to-mysql/</guid>
        <description>&lt;h2 id=&#34;介绍&#34;&gt;介绍&lt;/h2&gt;
&lt;p&gt;项目中，需要将数据库由 H2 迁移到 mariadb-5.5.60，迁移过程中遇到的问题汇总如下&lt;/p&gt;
&lt;h2 id=&#34;表名大小写敏感问题&#34;&gt;表名大小写敏感问题&lt;/h2&gt;
&lt;p&gt;在 linux 系统中，mysql/mariadb 对表名的大小写是敏感的，因为在 SQL 语句中，使用大写的表名，在 H2 中正常，但是迁移到 mariadb 后，提示找不到表。&lt;/p&gt;
&lt;p&gt;解决：将 SQL 语句中的表名改为小写&lt;/p&gt;
&lt;h2 id=&#34;date_format-函数问题&#34;&gt;DATE_FORMAT() 函数问题&lt;/h2&gt;
&lt;p&gt;在 H2 的 SQL 语句中，使用了 &lt;code&gt;FORMATDATETIME(create_time, &#39;yyyy-MM-dd HH:&#39;)&lt;/code&gt; 对日期进行格式化处理，转为 &lt;code&gt;mariadb&lt;/code&gt; &lt;code&gt;后，mariadb&lt;/code&gt; 不支持 &lt;code&gt;FORMATDATETIME()&lt;/code&gt; 函数，所以使用了 &lt;code&gt;DATE_FORMAT()&lt;/code&gt; 函数代替，但是，执行 sql 后发现查不到期望的数据。&lt;/p&gt;
&lt;p&gt;测试：
在 H2 控制台执行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FORMATDATETIME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2023-08-09 11:06:57&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;yyyy-MM-dd HH:&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;可以得到 &lt;code&gt;2023-08-09 11:&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在 mariadb 控制台执行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DATE_FORMAT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2023-08-09 11:06:57&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;yyyy-MM-dd HH:&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;得到 &lt;code&gt;yyyy-MM-dd HH:&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://www.w3school.com.cn/sql/func_date_format.asp&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://www.w3school.com.cn/sql/func_date_format.asp&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;DATE_FORMAT()&lt;/code&gt; 函数的格式化参数和 &lt;code&gt;FORMATDATETIME()&lt;/code&gt; 函数不同，将 SQL 修改为 &lt;code&gt;DATE_FORMAT(create_time, &#39;%Y-%m-%d %H:&#39;)&lt;/code&gt; 后，可以查到正确的数据。&lt;/p&gt;
&lt;p&gt;在 mariadb 控制台执行&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DATE_FORMAT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;2023-08-09 11:06:57&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;%Y-%m-%d %H:&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;得到正确的结果：&lt;code&gt;2023-08-09 11:&lt;/code&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>MySQL 大小写敏感配置</title>
        <link>https://msdemt.github.io/p/mysql-case-sensitive/</link>
        <pubDate>Fri, 11 Aug 2023 00:00:00 +0000</pubDate>
        
        <guid>https://msdemt.github.io/p/mysql-case-sensitive/</guid>
        <description>&lt;h2 id=&#34;介绍&#34;&gt;介绍&lt;/h2&gt;
&lt;p&gt;在 &lt;code&gt;MySQL&lt;/code&gt; 中，数据库对应数据目录中的目录，数据库中的每个表至少对应数据库目录中的一个文件（也可能是多个，取决于存储引擎）。因此，所使用&lt;code&gt;操作系统的大小写敏感性决定了数据库名和表名的大小写敏感性&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在大多数 &lt;code&gt;Unix&lt;/code&gt; 中数据库名和表名对大小写敏感，而在 &lt;code&gt;Windows&lt;/code&gt; 中对大小写不敏感。一个显著的例外情况是 &lt;code&gt;Mac OS X&lt;/code&gt; ，它基于 &lt;code&gt;Unix&lt;/code&gt; 但使用默认文件系统类型（&lt;code&gt;HFS+&lt;/code&gt;），对大小写不敏感。然而，&lt;code&gt;Mac OS X&lt;/code&gt; 也支持 &lt;code&gt;UFS&lt;/code&gt; 卷，该卷对大小写敏感，就像 &lt;code&gt;Unix&lt;/code&gt; 一样。&lt;/p&gt;
&lt;h2 id=&#34;lower_case_file_system-参数只读&#34;&gt;lower_case_file_system 参数（只读）&lt;/h2&gt;
&lt;p&gt;表示当前系统文件是否大小写敏感，&lt;code&gt;只读参数，无法修改&lt;/code&gt;。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ON: 大小写不敏感&lt;/li&gt;
&lt;li&gt;OFF: 大小写敏感&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;lower_case_table_names-参数&#34;&gt;lower_case_table_names 参数&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Unix&lt;/code&gt; 下 &lt;code&gt;lower_case_table_names&lt;/code&gt; 默认值为 &lt;code&gt;0&lt;/code&gt; ；&lt;code&gt;Windows&lt;/code&gt; 下默认值是 &lt;code&gt;1&lt;/code&gt; ；&lt;code&gt;Mac OS X&lt;/code&gt; 下默认值是 &lt;code&gt;2&lt;/code&gt; 。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;0&lt;/code&gt;: 使用 &lt;code&gt;CREATE TABLE&lt;/code&gt; 或 &lt;code&gt;CREATE DATABASE&lt;/code&gt; 语句指定的大小写字母在硬盘上保存表名和数据库名。名称比较对&lt;code&gt;大小写敏感&lt;/code&gt;。在大小写不敏感的操作系统如 &lt;code&gt;Windows&lt;/code&gt; 或 &lt;code&gt;Mac OS x&lt;/code&gt; 上我们不能将该参数设为 &lt;code&gt;0&lt;/code&gt; ，如果在大小写不敏感的文件系统上将 &lt;code&gt;--lowercase-table-names&lt;/code&gt; 强制设为 &lt;code&gt;0&lt;/code&gt; ，并且使用不同的大小写访问 &lt;code&gt;MyISAM&lt;/code&gt; 表名，可能会导致索引破坏。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;1&lt;/code&gt;: 表名在硬盘上以小写保存，名称比较对&lt;code&gt;大小写不敏感&lt;/code&gt;。 &lt;code&gt;MySQL&lt;/code&gt; 将所有表名转换为小写在存储和查找表上。该行为也适合数据库名和表的别名。该值为 &lt;code&gt;Windows&lt;/code&gt; 的默认值。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;2&lt;/code&gt;: 表名和数据库名在硬盘上使用 &lt;code&gt;CREATE TABLE&lt;/code&gt; 或 &lt;code&gt;CREATE DATABASE&lt;/code&gt; 语句指定的大小写字母进行保存，但 &lt;code&gt;MySQL&lt;/code&gt; 将它们转换为小写在查找表上。名称比较对大小写不敏感，即按照大小写来保存，按照小写来比较。注释：只在对大小写不敏感的文件系统上适用! &lt;code&gt;innodb&lt;/code&gt; 表名用小写保存。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;由大小写敏感转换为不敏感方法&#34;&gt;由大小写敏感转换为不敏感方法&lt;/h2&gt;
&lt;p&gt;如果原来所建立库及表都是对大小写敏感的，想要转换为对大小写不敏感，主要需要进行如下3步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将数据库数据通过 &lt;code&gt;mysqldump&lt;/code&gt; 导出。&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;my.cnf&lt;/code&gt; （ &lt;code&gt;CentOS&lt;/code&gt; 下配置文件是 &lt;code&gt;/etc/my.cnf&lt;/code&gt; ）中更改最后添加 &lt;code&gt;lower_case_tables_name = 1&lt;/code&gt;，然后重启 &lt;code&gt;mysql&lt;/code&gt; 数据库&lt;/li&gt;
&lt;li&gt;将导出的数据导入 &lt;code&gt;mysql&lt;/code&gt; 数据库。&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;注：&lt;code&gt;MySQL 8.0&lt;/code&gt; 开始，禁止在重新启动 &lt;code&gt;MySQL&lt;/code&gt; 服务时将 &lt;code&gt;lower_case_table_names&lt;/code&gt; 设置 成不同于初始化 &lt;code&gt;MySQL&lt;/code&gt; 服务时设置的 &lt;code&gt;lower_case_table_names&lt;/code&gt; 值。该值只能在初始化 &lt;code&gt;MySQL&lt;/code&gt; 之前设置。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;命名规则&#34;&gt;命名规则&lt;/h2&gt;
&lt;p&gt;为了避免大小写引发的问题，一种推荐的命名规则是：在定义数据库、表、列的时候全部采用小写字母加下划线的方式，不使用任何大写字母。&lt;/p&gt;
&lt;p&gt;在任何系统中可以使用 &lt;code&gt;lower_case_table_names=1&lt;/code&gt; 。使用该选项的不利之处是当使用 &lt;code&gt;SHOW TABLES&lt;/code&gt; 或 &lt;code&gt;SHOW DATABASES&lt;/code&gt; 时，看不出名字原来是用大写还是小写。&lt;/p&gt;
&lt;p&gt;请注意在 &lt;code&gt;Unix&lt;/code&gt; 中如果以前 &lt;code&gt;lower_case_table_names = 0&lt;/code&gt;，在将 &lt;code&gt;lower_case_table_names&lt;/code&gt; 设置为 &lt;code&gt;1&lt;/code&gt; 时，重启 &lt;code&gt;mysqld&lt;/code&gt; 之前，必须先将旧的数据库名和表名转换为小写。&lt;/p&gt;
&lt;h2 id=&#34;字段名大小写不敏感&#34;&gt;字段名大小写不敏感&lt;/h2&gt;
&lt;p&gt;数据库字段名，大小写不敏感&lt;/p&gt;
&lt;h2 id=&#34;字段值大小写敏感设置字符集和排序规则&#34;&gt;字段值大小写敏感设置，字符集和排序规则&lt;/h2&gt;
&lt;p&gt;字段值的大小写由 mysql 的校对规则来控制。提到校对规则，就不得不说字符集。字符集是一套符号和编码，校对规则是在字符集内用于比较字符的一套规则。&lt;/p&gt;
&lt;p&gt;一般而言，校对规则以其相关的字符集名开始，通常包括一个语言名，并且以 &lt;code&gt;_ci&lt;/code&gt;（大小写不敏感）、&lt;code&gt;_cs&lt;/code&gt;（大小写敏感）或 &lt;code&gt;_bin&lt;/code&gt;（二元）结束 。比如 &lt;code&gt;utf8&lt;/code&gt; 字符集，&lt;code&gt;utf8_general_ci&lt;/code&gt; 表示不区分大小写，这个是 &lt;code&gt;utf8&lt;/code&gt; 字符集默认的校对规则； &lt;code&gt;utf8_general_cs&lt;/code&gt; 表示区分大小写，&lt;code&gt;utf8_bin&lt;/code&gt; 表示二进制比较，同样也区分大小写 。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;参考：&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://blog.csdn.net/lishuoboy/article/details/84562007&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://blog.csdn.net/lishuoboy/article/details/84562007&lt;/a&gt;&lt;br&gt;
&lt;a class=&#34;link&#34; href=&#34;https://zhuanlan.zhihu.com/p/147720463&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://zhuanlan.zhihu.com/p/147720463&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        </item>
        
    </channel>
</rss>
