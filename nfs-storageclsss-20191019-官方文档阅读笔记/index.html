<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Nfs-Storageclsss-20191019-官方文档阅读笔记 - MyBlog</title><meta name="Description" content="我的博客"><meta property="og:title" content="Nfs-Storageclsss-20191019-官方文档阅读笔记" />
<meta property="og:description" content="StorageClass 参考： https://kubernetes.io/docs/concepts/storage/storage-classes/ https://github.com/kubernetes-incubator/external-storage Introduction A StorageClass provides a way for administrators to describe the “classes” of storage they offer. Different classes might map to quality-of-service(服务质量) levels, or to backup policie" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" />
<meta property="og:image" content="https://msdemt.github.io/logo.png"/>
<meta property="article:published_time" content="2019-10-19T19:36:43+08:00" />
<meta property="article:modified_time" content="2019-10-19T19:36:43+08:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://msdemt.github.io/logo.png"/>

<meta name="twitter:title" content="Nfs-Storageclsss-20191019-官方文档阅读笔记"/>
<meta name="twitter:description" content="StorageClass 参考： https://kubernetes.io/docs/concepts/storage/storage-classes/ https://github.com/kubernetes-incubator/external-storage Introduction A StorageClass provides a way for administrators to describe the “classes” of storage they offer. Different classes might map to quality-of-service(服务质量) levels, or to backup policie"/>
<meta name="application-name" content="MyBlog">
<meta name="apple-mobile-web-app-title" content="MyBlog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" /><link rel="prev" href="https://msdemt.github.io/cert-manager-v0.11-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" /><link rel="next" href="https://msdemt.github.io/centos7%E6%90%AD%E5%BB%BAnfs-server-20191019/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Nfs-Storageclsss-20191019-官方文档阅读笔记",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/msdemt.github.io\/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0\/"
        },"image": ["https:\/\/msdemt.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","wordcount":  5119 ,
        "url": "https:\/\/msdemt.github.io\/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0\/","datePublished": "2019-10-19T19:36:43+08:00","dateModified": "2019-10-19T19:36:43+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/msdemt.github.io\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "hekai"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="MyBlog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>MyBlog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 所有文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/categories/documentation/"> 文档 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="MyBlog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw'></i></span>MyBlog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">所有文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/categories/documentation/" title="">文档</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Nfs-Storageclsss-20191019-官方文档阅读笔记</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>hekai</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2019-10-19">2019-10-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 5119 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 11 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#storageclass">StorageClass</a>
      <ul>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#the-storageclass-resource">The StorageClass Resource</a>
          <ul>
            <li><a href="#provisioner">Provisioner</a></li>
            <li><a href="#reclaim-policy回收策略">Reclaim Policy(回收策略)</a></li>
            <li><a href="#allow-volume-expansion允许卷扩容">Allow Volume Expansion(允许卷扩容)</a></li>
            <li><a href="#mount-options">Mount Options</a></li>
            <li><a href="#volume-binding-mode">Volume Binding Mode</a></li>
            <li><a href="#allowed-topologies">Allowed Topologies</a></li>
          </ul>
        </li>
        <li><a href="#parameters">Parameters</a>
          <ul>
            <li><a href="#aws-ebs">AWS EBS</a></li>
            <li><a href="#gce-pd">GCE PD</a></li>
            <li><a href="#glusterfs">Glusterfs</a></li>
            <li><a href="#openstack-cinder">OpenStack Cinder</a></li>
            <li><a href="#vsphere">vSphere</a></li>
            <li><a href="#ceph-rbd">Ceph RBD</a></li>
            <li><a href="#quobyte">Quobyte</a></li>
            <li><a href="#azure-disk">Azure Disk</a></li>
            <li><a href="#azure-file">Azure File</a></li>
            <li><a href="#portworx-volume">Portworx Volume</a></li>
            <li><a href="#scaleio">ScaleIO</a></li>
            <li><a href="#storageos">StorageOS</a></li>
            <li><a href="#local">Local</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#nfs-storageclass">nfs-storageclass</a>
      <ul>
        <li><a href="#部署-nfs-server">部署 NFS server</a></li>
        <li><a href="#部署-nfs-client">部署 NFS client</a>
          <ul>
            <li><a href="#with-helm">With Helm</a></li>
            <li><a href="#without-helm">Without Helm</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="storageclass">StorageClass</h2>
<blockquote>
<p>参考：<br>
<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/">https://kubernetes.io/docs/concepts/storage/storage-classes/</a><br>
<a href="https://github.com/kubernetes-incubator/external-storage">https://github.com/kubernetes-incubator/external-storage</a></p>
</blockquote>
<h3 id="introduction">Introduction</h3>
<p>A <code>StorageClass</code> provides a way for administrators to describe the “classes” of storage they offer. Different classes might map to quality-of-service(服务质量) levels, or to backup policies(备份策略), or to arbitrary(任意的) policies determined by the cluster administrators. Kubernetes itself is unopinionated(不关注，没有意见) about what classes represent. This concept is sometimes called “profiles” in other storage systems.</p>
<h3 id="the-storageclass-resource">The StorageClass Resource</h3>
<p>Each <code>StorageClass</code> contains the fields <code>provisioner(供应者)</code>, <code>parameters</code>, and <code>reclaimPolicy</code>, which are used when a <code>PersistentVolume</code> belonging to the class needs to be dynamically(动态地) provisioned.</p>
<p>The name of a <code>StorageClass</code> object is significant(重要), and is how users can request a particular class. Administrators set the name and other parameters of a class when first creating <code>StorageClass</code> objects, and the objects cannot be updated once they are created.</p>
<p>Administrators can specify a default <code>StorageClass</code> just for PVCs that don’t request any particular class to bind to: see the <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#class-1" target="_blank" rel="noopener noreffer">PersistentVolumeClaim</a> section for details.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>standard<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/aws-ebs<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>gp2<span class="w">
</span><span class="w"></span><span class="k">reclaimPolicy</span><span class="p">:</span><span class="w"> </span>Retain<span class="w">
</span><span class="w"></span><span class="k">allowVolumeExpansion</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="k">mountOptions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- debug<span class="w">
</span><span class="w"></span><span class="k">volumeBindingMode</span><span class="p">:</span><span class="w"> </span>Immediate<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h4 id="provisioner">Provisioner</h4>
<p>Storage classes have a provisioner that determines what volume plugin is used for provisioning PVs. This field must be specified.</p>
<table>
<thead>
<tr>
<th>Volume Plugin</th>
<th>Internal Provisioner</th>
<th>Config Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWSElasticBlockStore</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#aws-ebs" target="_blank" rel="noopener noreffer">AWS EBS</a></td>
</tr>
<tr>
<td>AzureFile</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#azure-file" target="_blank" rel="noopener noreffer">Azure File</a></td>
</tr>
<tr>
<td>AzureDisk</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#azure-disk" target="_blank" rel="noopener noreffer">Azure Disk</a></td>
</tr>
<tr>
<td>CephFS</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Cinder</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#openstack-cinder" target="_blank" rel="noopener noreffer">OpenStack Cinder</a></td>
</tr>
<tr>
<td>FC</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>FlexVolume</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Flocker</td>
<td>✓</td>
<td>-</td>
</tr>
<tr>
<td>GCEPersistentDisk</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#gce-pd" target="_blank" rel="noopener noreffer">GCE PD</a></td>
</tr>
<tr>
<td>Glusterfs</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#glusterfs" target="_blank" rel="noopener noreffer">Glusterfs</a></td>
</tr>
<tr>
<td>iSCSI</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Quobyte</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#quobyte" target="_blank" rel="noopener noreffer">Quobyte</a></td>
</tr>
<tr>
<td>NFS</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>RBD</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#ceph-rbd" target="_blank" rel="noopener noreffer">Ceph RBD</a></td>
</tr>
<tr>
<td>VsphereVolume</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#vsphere" target="_blank" rel="noopener noreffer">vSphere</a></td>
</tr>
<tr>
<td>PortworxVolume</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#portworx-volume" target="_blank" rel="noopener noreffer">Portworx Volume</a></td>
</tr>
<tr>
<td>ScaleIO</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#scaleio" target="_blank" rel="noopener noreffer">ScaleIO</a></td>
</tr>
<tr>
<td>StorageOS</td>
<td>✓</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#storageos" target="_blank" rel="noopener noreffer">StorageOS</a></td>
</tr>
<tr>
<td>Local</td>
<td>-</td>
<td><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#local" target="_blank" rel="noopener noreffer">Local</a></td>
</tr>
</tbody>
</table>
<p>You are not restricted to specifying the “internal” provisioners listed here (whose names are prefixed with “kubernetes.io” and shipped alongside Kubernetes). You can also run and specify external provisioners, which are independent programs that follow a <a href="https://git.k8s.io/community/contributors/design-proposals/storage/volume-provisioning.md" target="_blank" rel="noopener noreffer">specification</a> defined by Kubernetes. Authors of external provisioners have full discretion over where their code lives, how the provisioner is shipped, how it needs to be run, what volume plugin it uses (including Flex), etc. The repository <a href="https://github.com/kubernetes-sigs/sig-storage-lib-external-provisioner" target="_blank" rel="noopener noreffer">kubernetes-sigs/sig-storage-lib-external-provisioner</a> houses a library for writing external provisioners that implements the bulk of the specification. Some external provisioners are listed under the repository <a href="https://github.com/kubernetes-incubator/external-storage" target="_blank" rel="noopener noreffer">kubernetes-incubator/external-storage</a>.</p>
<p>For example, NFS doesn’t provide an internal provisioner, but an external provisioner can be used. There are also cases when 3rd party storage vendors provide their own external provisioner.</p>
<h4 id="reclaim-policy回收策略">Reclaim Policy(回收策略)</h4>
<p>Persistent Volumes that are dynamically created by a storage class will have the reclaim policy specified in the <code>reclaimPolicy</code> field of the class, which can be either <code>Delete</code> or <code>Retain</code>. If no <code>reclaimPolicy</code> is specified when a StorageClass object is created, it will default to <code>Delete</code>.</p>
<p>Persistent Volumes that are created manually and managed via a storage class will have whatever reclaim policy they were assigned at creation.</p>
<h4 id="allow-volume-expansion允许卷扩容">Allow Volume Expansion(允许卷扩容)</h4>
<p><strong>FEATURE STATE</strong>: Kubernetes v1.11 beta</p>
<p>Persistent Volumes can be configured to be expandable. This feature when set to <code>true</code>, allows the users to resize the volume by editing the corresponding PVC object.</p>
<p>The following types of volumes support volume expansion, when the underlying Storage Class has the field <code>allowVolumeExpansion</code> set to true.</p>
<table>
<thead>
<tr>
<th>Volume type</th>
<th>Required Kubernetes version</th>
</tr>
</thead>
<tbody>
<tr>
<td>gcePersistentDisk</td>
<td>1.11</td>
</tr>
<tr>
<td>awsElasticBlockStore</td>
<td>1.11</td>
</tr>
<tr>
<td>Cinder</td>
<td>1.11</td>
</tr>
<tr>
<td>glusterfs</td>
<td>1.11</td>
</tr>
<tr>
<td>rbd</td>
<td>1.11</td>
</tr>
<tr>
<td>Azure File</td>
<td>1.11</td>
</tr>
<tr>
<td>Azure Disk</td>
<td>1.11</td>
</tr>
<tr>
<td>Portworx</td>
<td>1.11</td>
</tr>
<tr>
<td>FlexVolume</td>
<td>1.13</td>
</tr>
<tr>
<td>CSI</td>
<td>1.14 (alpha), 1.16 (beta)</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note</strong>: You can only use the volume expansion feature to grow a Volume, not to shrink(收缩) it.</p>
</blockquote>
<h4 id="mount-options">Mount Options</h4>
<p>Persistent Volumes that are dynamically created by a storage class will have the mount options specified in the <code>mountOptions</code> field of the class.</p>
<p>If the volume plugin does not support mount options but mount options are specified, provisioning will fail. Mount options are not validated on either the class or PV, so mount of the PV will simply fail if one is invalid.</p>
<h4 id="volume-binding-mode">Volume Binding Mode</h4>
<p>The <code>volumeBindingMode</code> field controls when <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#provisioning" target="_blank" rel="noopener noreffer">volume binding and dynamic provisioning</a> should occur.</p>
<p>By default, the <code>Immediate</code> mode indicates that volume binding and dynamic provisioning occurs once the PersistentVolumeClaim is created. For storage backends that are topology-constrained(拓扑约束) and not globally accessible from all Nodes in the cluster, PersistentVolumes will be bound or provisioned without knowledge of the Pod’s scheduling requirements. This may result in unschedulable Pods.</p>
<p>A cluster administrator can address this issue by specifying the <code>WaitForFirstConsumer</code> mode which will delay the binding and provisioning of a PersistentVolume until a Pod using the PersistentVolumeClaim is created. PersistentVolumes will be selected or provisioned conforming to the topology that is specified by the Pod’s scheduling constraints. These include, but are not limited to, <a href="https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container" target="_blank" rel="noopener noreffer">resource requirements</a>, <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector" target="_blank" rel="noopener noreffer">node selectors</a>, <a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity" target="_blank" rel="noopener noreffer">pod affinity and anti-affinity</a>, and <a href="https://kubernetes.io/docs/concepts/configuration/taint-and-toleration" target="_blank" rel="noopener noreffer">taints and tolerations</a>.</p>
<p>The following plugins support <code>WaitForFirstConsumer</code> with dynamic provisioning:</p>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#aws-ebs" target="_blank" rel="noopener noreffer">AWSElasticBlockStore</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#gce-pd" target="_blank" rel="noopener noreffer">GCEPersistentDisk</a></li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#azure-disk" target="_blank" rel="noopener noreffer">AzureDisk</a></li>
</ul>
<p>The following plugins support <code>WaitForFirstConsumer</code> with pre-created PersistentVolume binding:</p>
<ul>
<li>All of the above</li>
<li><a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#local" target="_blank" rel="noopener noreffer">Local</a></li>
</ul>
<p><strong>FEATURE STATE</strong>: Kubernetes 1.14 beta</p>
<p>CSI volumes are also supported with dynamic provisioning and pre-created PVs, but you’ll need to look at the documentation for a specific CSI driver to see its supported topology keys and examples. The <code>CSINodeInfo</code> feature gate must be enabled.</p>
<h4 id="allowed-topologies">Allowed Topologies</h4>
<p>When a cluster operator specifies the <code>WaitForFirstConsumer</code> volume binding mode, it is no longer necessary to restrict provisioning to specific topologies in most situations. However, if still required, <code>allowedTopologies</code> can be specified.</p>
<p>This example demonstrates how to restrict the topology of provisioned volumes to specific zones and should be used as a replacement for the zone and zones parameters for the supported plugins.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>standard<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/gce-pd<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>pd-standard<span class="w">
</span><span class="w"></span><span class="k">volumeBindingMode</span><span class="p">:</span><span class="w"> </span>WaitForFirstConsumer<span class="w">
</span><span class="w"></span><span class="k">allowedTopologies</span><span class="p">:</span><span class="w">
</span><span class="w"></span>- <span class="k">matchLabelExpressions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="k">key</span><span class="p">:</span><span class="w"> </span>failure-domain.beta.kubernetes.io/zone<span class="w">
</span><span class="w">    </span><span class="k">values</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- us-central1-a<span class="w">
</span><span class="w">    </span>- us-central1-b<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><h3 id="parameters">Parameters</h3>
<p>Storage classes have parameters that describe volumes belonging to the storage class. Different parameters may be accepted depending on the <code>provisioner</code>. For example, the value <code>io1</code>, for the parameter <code>type</code>, and the parameter <code>iopsPerGB</code> are specific to EBS. When a parameter is omitted, some default is used.</p>
<h4 id="aws-ebs">AWS EBS</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/aws-ebs<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>io1<span class="w">
</span><span class="w">  </span><span class="k">iopsPerGB</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;10&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">fsType</span><span class="p">:</span><span class="w"> </span>ext4<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>type</strong>: <code>io1</code>, <code>gp2</code>, <code>sc1</code>, <code>st1</code>. See <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html" target="_blank" rel="noopener noreffer">AWS docs</a> for details. Default: <code>gp2</code>.</li>
<li><strong>zone</strong> (Deprecated): AWS zone. If neither <code>zone</code> nor <code>zones</code> is specified, volumes are generally round-robin-ed across all active zones where Kubernetes cluster has a node. <code>zone</code> and <code>zones</code> parameters must not be used at the same time.</li>
<li><strong>zones</strong> (Deprecated): A comma separated list of AWS zone(s). If neither <code>zone</code> nor <code>zones</code> is specified, volumes are generally round-robin-ed across all active zones where Kubernetes cluster has a node. <code>zone</code> and <code>zones</code> parameters must not be used at the same time.</li>
<li><strong>iopsPerGB</strong>: only for <code>io1</code> volumes. I/O operations per second per GiB. AWS volume plugin multiplies this with size of requested volume to compute IOPS of the volume and caps it at 20 000 IOPS (maximum supported by AWS, see <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html" target="_blank" rel="noopener noreffer">AWS docs</a>. A string is expected here, i.e. <code>&quot;10&quot;</code>, not <code>10</code>.</li>
<li><strong>fsType</strong>: fsType that is supported by kubernetes. Default: &ldquo;<code>ext4</code>&rdquo;.</li>
<li><strong>encrypted</strong>: denotes whether the EBS volume should be encrypted or not. Valid values are <code>&quot;true&quot;</code> or <code>&quot;false&quot;</code>. A string is expected here, i.e. <code>&quot;true&quot;</code>, not <code>true</code>.</li>
<li><strong>kmsKeyId</strong>: optional. The full Amazon Resource Name of the key to use when encrypting the volume. If none is supplied but <code>encrypted</code> is true, a key is generated by AWS. See AWS docs for valid ARN value.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: <code>zone</code> and <code>zones</code> parameters are deprecated and replaced with <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#allowed-topologies" target="_blank" rel="noopener noreffer">allowedTopologies</a></p>
</blockquote>
<h4 id="gce-pd">GCE PD</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/gce-pd<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>pd-standard<span class="w">
</span><span class="w">  </span><span class="k">replication-type</span><span class="p">:</span><span class="w"> </span>none<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>type</strong>: <code>pd-standard</code> or <code>pd-ssd</code>. Default: <code>pd-standard</code></p>
</li>
<li>
<p><strong>zone</strong> (Deprecated): GCE zone. If neither <code>zone</code> nor <code>zones</code> is specified, volumes are generally round-robin-ed across all active zones where Kubernetes cluster has a node. <code>zone</code> and <code>zones</code> parameters must not be used at the same time.</p>
</li>
<li>
<p><strong>zones</strong> (Deprecated): A comma separated list of GCE zone(s). If neither <code>zone</code> nor <code>zones</code> is specified, volumes are generally round-robin-ed across all active zones where Kubernetes cluster has a node. <code>zone</code> and <code>zones</code> parameters must not be used at the same time.</p>
</li>
<li>
<p><strong>replication-type</strong>: <code>none</code> or <code>regional-pd</code>. Default: <code>none</code>.</p>
<p>If <code>replication-type</code> is set to <code>none</code>, a regular (zonal) PD will be provisioned.</p>
<p>If <code>replication-type</code> is set to <code>regional-pd</code>, a <a href="https://cloud.google.com/compute/docs/disks/#repds" target="_blank" rel="noopener noreffer">Regional Persistent Disk</a> will be provisioned. In this case, users must use <code>zones</code> instead of <code>zone</code> to specify the desired replication zones. If exactly two zones are specified, the Regional PD will be provisioned in those zones. If more than two zones are specified, Kubernetes will arbitrarily choose among the specified zones. If the <code>zones</code> parameter is omitted, Kubernetes will arbitrarily choose among zones managed by the cluster.</p>
</li>
</ul>
<blockquote>
<p><strong>Note</strong>: <code>zone</code> and <code>zones</code> parameters are deprecated and replaced with <a href="https://kubernetes.io/docs/concepts/storage/storage-classes/#allowed-topologies" target="_blank" rel="noopener noreffer">allowedTopologies</a></p>
</blockquote>
<h4 id="glusterfs">Glusterfs</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/glusterfs<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">resturl</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://127.0.0.1:8081&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">clusterid</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;630372ccdc720a92c681fb928f27b53f&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">restauthenabled</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">restuser</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;admin&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">secretNamespace</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;default&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">secretName</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;heketi-secret&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">gidMin</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;40000&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">gidMax</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">volumetype</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;replicate:3&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>resturl</strong>: Gluster REST service/Heketi service url which provision gluster volumes on demand. The general format should be <code>IPaddress:Port</code> and this is a mandatory(强制性的) parameter for GlusterFS dynamic provisioner. If Heketi service is exposed as a routable service in openshift/kubernetes setup, this can have a format similar to <code>http://heketi-storage-project.cloudapps.mystorage.com</code> where the fqdn is a resolvable Heketi service url.</li>
<li><strong>restauthenabled</strong> : Gluster REST service authentication boolean that enables authentication to the REST server. If this value is <code>&quot;true&quot;</code>, <code>restuser</code> and <code>restuserkey</code> or <code>secretNamespace</code> + <code>secretName</code> have to be filled. This option is deprecated, authentication is enabled when any of <code>restuser</code>, <code>restuserkey</code>, <code>secretName</code> or <code>secretNamespace</code> is specified.</li>
<li><strong>restuser</strong> : Gluster REST service/Heketi user who has access to create volumes in the Gluster Trusted Pool.</li>
<li><strong>restuserkey</strong> : Gluster REST service/Heketi user’s password which will be used for authentication to the REST server. This parameter is deprecated in favor of <code>secretNamespace</code> + <code>secretName</code>.</li>
<li><strong>secretNamespace</strong>, <strong>secretName</strong> : Identification of Secret instance that contains user password to use when talking to Gluster REST service. These parameters are optional, empty password will be used when both <code>secretNamespace</code> and <code>secretName</code> are omitted. The provided secret must have type <code>&quot;kubernetes.io/glusterfs&quot;</code>, e.g. created in this way:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl create secret generic heketi-secret <span class="se">\
</span><span class="se"></span>  --type<span class="o">=</span><span class="s2">&#34;kubernetes.io/glusterfs&#34;</span> --from-literal<span class="o">=</span><span class="nv">key</span><span class="o">=</span><span class="s1">&#39;opensesame&#39;</span> <span class="se">\
</span><span class="se"></span>  --namespace<span class="o">=</span>default
</code></pre></td></tr></table>
</div>
</div><p>Example of a secret can be found in <a href="https://github.com/kubernetes/examples/tree/master/staging/persistent-volume-provisioning/glusterfs/glusterfs-secret.yaml" target="_blank" rel="noopener noreffer">glusterfs-provisioning-secret.yaml</a>.</p>
<ul>
<li>
<p><strong>clusterid</strong>: <code>630372ccdc720a92c681fb928f27b53f</code> is the ID of the cluster which will be used by Heketi when provisioning the volume. It can also be a list of clusterids, for example: <code>&quot;8452344e2becec931ece4e33c4674e4e,42982310de6c63381718ccfa6d8cf397&quot;</code>. This is an optional parameter.</p>
</li>
<li>
<p><strong>gidMin</strong>, <strong>gidMax</strong> : The minimum and maximum value of GID range for the storage class. A unique value (GID) in this range ( gidMin-gidMax ) will be used for dynamically provisioned volumes. These are optional values. If not specified, the volume will be provisioned with a value between 2000-2147483647 which are defaults for gidMin and gidMax respectively.</p>
</li>
<li>
<p><strong>volumetype</strong> : The volume type and its parameters can be configured with this optional value. If the volume type is not mentioned, it’s up to the provisioner to decide the volume type.
For example:</p>
<ul>
<li><strong>Replica volume</strong>: <code>volumetype: replicate:3</code> where ‘3’ is replica count.</li>
<li><strong>Disperse/EC volume</strong>: <code>volumetype: disperse:4:2</code> where ‘4’ is data and ‘2’ is the redundancy count.</li>
<li><strong>Distribute volume</strong>: volumetype: none</li>
</ul>
<p>For available volume types and administration options, refer to the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Storage/3.1/html/Administration_Guide/part-Overview.html" target="_blank" rel="noopener noreffer">Administration</a> Guide.</p>
</li>
</ul>
<p>For further reference information, see <a href="https://github.com/heketi/heketi/wiki/Setting-up-the-topology" target="_blank" rel="noopener noreffer">How to configure Heketi</a>.</p>
<p>When persistent volumes are dynamically provisioned, the Gluster plugin automatically creates an endpoint and a headless service in the name <code>gluster-dynamic-&lt;claimname&gt;</code>. The dynamic endpoint and service are automatically deleted when the persistent volume claim is deleted.</p>
<h4 id="openstack-cinder">OpenStack Cinder</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>gold<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/cinder<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">availability</span><span class="p">:</span><span class="w"> </span>nova<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>availability</strong>: Availability Zone. If not specified, volumes are generally round-robin-ed across all active zones where Kubernetes cluster has a node.</li>
</ul>
<blockquote>
<p><strong>Note</strong>:<br>
<strong>FEATURE STATE</strong>: Kubernetes 1.11 deprecated<br>
This internal provisioner of OpenStack is deprecated. Please use <a href="https://github.com/kubernetes/cloud-provider-openstack" target="_blank" rel="noopener noreffer">the external cloud provider for OpenStack</a>.</p>
</blockquote>
<h4 id="vsphere">vSphere</h4>
<ol>
<li>
<p>Create a StorageClass with a user specified disk format.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>fast<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/vsphere-volume<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">diskformat</span><span class="p">:</span><span class="w"> </span>zeroedthick<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><strong>diskformat</strong>: <code>thin</code>, <code>zeroedthick</code> and <code>eagerzeroedthick</code>. Default: &ldquo;<code>thin</code>&rdquo;.</p>
</li>
<li>
<p>Create a StorageClass with a disk format on a user specified datastore.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w"></span><span class="k">name</span><span class="p">:</span><span class="w"> </span>fast<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/vsphere-volume<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">diskformat</span><span class="p">:</span><span class="w"> </span>zeroedthick<span class="w">
</span><span class="w">    </span><span class="k">datastore</span><span class="p">:</span><span class="w"> </span>VSANDatastore<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><strong>datastore</strong>: The user can also specify the datastore in the StorageClass. The volume will be created on the datastore specified in the storage class, which in this case is <code>VSANDatastore</code>. This field is optional. If the datastore is not specified, then the volume will be created on the datastore specified in the vSphere config file used to initialize the vSphere Cloud Provider.</p>
</li>
<li>
<p>Storage Policy Management inside kubernetes</p>
<ul>
<li>
<p>Using existing vCenter SPBM policy</p>
<p>One of the most important features of vSphere for Storage Management is policy based Management. Storage Policy Based Management (SPBM) is a storage policy framework that provides a single unified control plane across a broad range of data services and storage solutions. SPBM enables vSphere administrators to overcome upfront storage provisioning challenges, such as capacity planning, differentiated service levels and managing capacity headroom.</p>
<p>The SPBM policies can be specified in the StorageClass using the <code>storagePolicyName</code> parameter.</p>
</li>
<li>
<p>Virtual SAN policy support inside Kubernetes</p>
<p>Vsphere Infrastructure (VI) Admins will have the ability to specify custom Virtual SAN Storage Capabilities during dynamic volume provisioning. You can now define storage requirements, such as performance and availability, in the form of storage capabilities during dynamic volume provisioning. The storage capability requirements are converted into a Virtual SAN policy which are then pushed down to the Virtual SAN layer when a persistent volume (virtual disk) is being created. The virtual disk is distributed across the Virtual SAN datastore to meet the requirements.</p>
<p>You can see <a href="https://vmware.github.io/vsphere-storage-for-kubernetes/documentation/policy-based-mgmt.html" target="_blank" rel="noopener noreffer">Storage Policy Based Management for dynamic provisioning of volumes</a> for more details on how to use storage policies for persistent volumes management.</p>
</li>
</ul>
</li>
</ol>
<p>There are few <a href="https://github.com/kubernetes/examples/tree/master/staging/volumes/vsphere" target="_blank" rel="noopener noreffer">vSphere examples</a> which you try out for persistent volume management inside Kubernetes for vSphere.</p>
<h4 id="ceph-rbd">Ceph RBD</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>fast<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/rbd<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">monitors</span><span class="p">:</span><span class="w"> </span><span class="m">10.16.153.105</span><span class="p">:</span><span class="m">6789</span><span class="w">
</span><span class="w">  </span><span class="k">adminId</span><span class="p">:</span><span class="w"> </span>kube<span class="w">
</span><span class="w">  </span><span class="k">adminSecretName</span><span class="p">:</span><span class="w"> </span>ceph-secret<span class="w">
</span><span class="w">  </span><span class="k">adminSecretNamespace</span><span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span><span class="k">pool</span><span class="p">:</span><span class="w"> </span>kube<span class="w">
</span><span class="w">  </span><span class="k">userId</span><span class="p">:</span><span class="w"> </span>kube<span class="w">
</span><span class="w">  </span><span class="k">userSecretName</span><span class="p">:</span><span class="w"> </span>ceph-secret-user<span class="w">
</span><span class="w">  </span><span class="k">userSecretNamespace</span><span class="p">:</span><span class="w"> </span>default<span class="w">
</span><span class="w">  </span><span class="k">fsType</span><span class="p">:</span><span class="w"> </span>ext4<span class="w">
</span><span class="w">  </span><span class="k">imageFormat</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">imageFeatures</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;layering&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>monitors</strong>: Ceph monitors, comma delimited. This parameter is required.</p>
</li>
<li>
<p><strong>adminId</strong>: Ceph client ID that is capable of creating images in the pool. Default is “admin”.</p>
</li>
<li>
<p><strong>adminSecretName</strong>: Secret Name for <code>adminId</code>. This parameter is required. The provided secret must have type “kubernetes.io/rbd”.</p>
</li>
<li>
<p><strong>adminSecretNamespace</strong>: The namespace for <code>adminSecretName</code>. Default is “default”.</p>
</li>
<li>
<p><strong>pool</strong>: Ceph RBD pool. Default is “rbd”.</p>
</li>
<li>
<p><strong>userId</strong>: Ceph client ID that is used to map the RBD image. Default is the same as <code>adminId</code>.</p>
</li>
<li>
<p><strong>userSecretName</strong>: The name of Ceph Secret for <code>userId</code> to map RBD image. It must exist in the same namespace as PVCs. This parameter is required. The provided secret must have type “kubernetes.io/rbd”, e.g. created in this way:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl create secret generic ceph-secret --type<span class="o">=</span><span class="s2">&#34;kubernetes.io/rbd&#34;</span> <span class="se">\
</span><span class="se"></span>--from-literal<span class="o">=</span><span class="nv">key</span><span class="o">=</span><span class="s1">&#39;QVFEQ1pMdFhPUnQrSmhBQUFYaERWNHJsZ3BsMmNjcDR6RFZST0E9PQ==&#39;</span> <span class="se">\
</span><span class="se"></span>--namespace<span class="o">=</span>kube-system
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>userSecretNamespace</strong>: The namespace for <code>userSecretName</code>.</p>
</li>
<li>
<p><strong>fsType</strong>: fsType that is supported by kubernetes. Default: <code>&quot;ext4&quot;</code>.</p>
</li>
<li>
<p><strong>imageFormat</strong>: Ceph RBD image format, “1” or “2”. Default is “2”.</p>
</li>
<li>
<p><strong>imageFeatures</strong>: This parameter is optional and should only be used if you set <code>imageFormat</code> to “2”. Currently supported features are <code>layering</code> only. Default is “”, and no features are turned on.</p>
</li>
</ul>
<h4 id="quobyte">Quobyte</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/quobyte<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">quobyteAPIServer</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://138.68.74.142:7860&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">registry</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;138.68.74.142:7861&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">adminSecretName</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;quobyte-admin-secret&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">adminSecretNamespace</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kube-system&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">user</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;root&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">group</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;root&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">quobyteConfig</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;BASE&#34;</span><span class="w">
</span><span class="w">    </span><span class="k">quobyteTenant</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;DEFAULT&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>quobyteAPIServer</strong>: API Server of Quobyte in the format <code>&quot;http(s)://api-server:7860&quot;</code></p>
</li>
<li>
<p><strong>registry</strong>: Quobyte registry to use to mount the volume. You can specify the registry as <code>&lt;host&gt;:&lt;port&gt;</code> pair or if you want to specify multiple registries you just have to put a comma between them e.q. <code>&lt;host1&gt;:&lt;port&gt;,&lt;host2&gt;:&lt;port&gt;,&lt;host3&gt;:&lt;port&gt;</code>. The host can be an IP address or if you have a working DNS you can also provide the DNS names.</p>
</li>
<li>
<p><strong>adminSecretNamespace</strong>: The namespace for <strong>adminSecretName</strong>. Default is “default”.</p>
</li>
<li>
<p><strong>adminSecretName</strong>: secret that holds information about the Quobyte user and the password to authenticate against the API server. The provided secret must have type “kubernetes.io/quobyte” and the keys <code>user</code> and <code>password</code>, e.g. created in this way:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl create secret generic quobyte-admin-secret <span class="se">\
</span><span class="se"></span>--type<span class="o">=</span><span class="s2">&#34;kubernetes.io/quobyte&#34;</span> --from-literal<span class="o">=</span><span class="nv">user</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span> --from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span><span class="s1">&#39;opensesame&#39;</span> <span class="se">\
</span><span class="se"></span>--namespace<span class="o">=</span>kube-system
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>user</strong>: maps all access to this user. Default is “root”.</p>
</li>
<li>
<p><strong>group</strong>: maps all access to this group. Default is “nfsnobody”.</p>
</li>
<li>
<p><strong>quobyteConfig</strong>: use the specified configuration to create the volume. You can create a new configuration or modify an existing one with the Web console or the quobyte CLI. Default is “BASE”.</p>
</li>
<li>
<p><strong>quobyteTenant</strong>: use the specified tenant ID to create/delete the volume. This Quobyte tenant has to be already present in Quobyte. Default is “DEFAULT”.</p>
</li>
</ul>
<h4 id="azure-disk">Azure Disk</h4>
<p><em><strong>Azure Unmanaged Disk Storage Class</strong></em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/azure-disk<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">skuName</span><span class="p">:</span><span class="w"> </span>Standard_LRS<span class="w">
</span><span class="w">  </span><span class="k">location</span><span class="p">:</span><span class="w"> </span>eastus<span class="w">
</span><span class="w">  </span><span class="k">storageAccount</span><span class="p">:</span><span class="w"> </span>azure_storage_account_name<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>skuName</strong>: Azure storage account Sku tier. Default is empty.</li>
<li><strong>location</strong>: Azure storage account location. Default is empty.</li>
<li><strong>storageAccount</strong>: Azure storage account name. If a storage account is provided, it must reside in the same resource group as the cluster, and location is ignored. If a storage account is not provided, a new storage account will be created in the same resource group as the cluster.</li>
</ul>
<p><em><strong>New Azure Disk Storage Class (starting from v1.7.2)</strong></em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/azure-disk<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">storageaccounttype</span><span class="p">:</span><span class="w"> </span>Standard_LRS<span class="w">
</span><span class="w">  </span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>Shared<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><strong>storageaccounttype</strong>: Azure storage account Sku tier. Default is empty.</p>
</li>
<li>
<p><strong>kind</strong>: Possible values are <code>shared</code> (default), <code>dedicated</code>, and <code>managed</code>. When <code>kind</code> is <code>shared</code>, all unmanaged disks are created in a few shared storage accounts in the same resource group as the cluster. When <code>kind</code> is <code>dedicated</code>, a new dedicated storage account will be created for the new unmanaged disk in the same resource group as the cluster. When <code>kind</code> is <code>managed</code>, all managed disks are created in the same resource group as the cluster.</p>
</li>
<li>
<p><strong>resourceGroup</strong>: Specify the resource group in which the Azure disk will be created. It must be an existing resource group name. If it is unspecified, the disk will be placed in the same resource group as the current Kubernetes cluster.</p>
</li>
<li>
<p>Premium VM can attach both Standard_LRS and Premium_LRS disks, while Standard VM can only attach Standard_LRS disks.</p>
</li>
<li>
<p>Managed VM can only attach managed disks and unmanaged VM can only attach unmanaged disks.</p>
</li>
</ul>
<h4 id="azure-file">Azure File</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>azurefile<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/azure-file<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">skuName</span><span class="p">:</span><span class="w"> </span>Standard_LRS<span class="w">
</span><span class="w">  </span><span class="k">location</span><span class="p">:</span><span class="w"> </span>eastus<span class="w">
</span><span class="w">  </span><span class="k">storageAccount</span><span class="p">:</span><span class="w"> </span>azure_storage_account_name<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>skuName</strong>: Azure storage account Sku tier. Default is empty.</li>
<li><strong>location</strong>: Azure storage account location. Default is empty.</li>
<li><strong>storageAccount</strong>: Azure storage account name. Default is empty. If a storage account is not provided, all storage accounts associated with the resource group are searched to find one that matches skuName and location. If a storage account is provided, it must reside in the same resource group as the cluster, and skuName and location are ignored.</li>
<li><strong>secretNamespace</strong>: the namespace of the secret that contains the Azure Storage Account Name and Key. Default is the same as the Pod.</li>
<li><strong>secretName</strong>: the name of the secret that contains the Azure Storage Account Name and Key. Default is <code>azure-storage-account-&lt;accountName&gt;-secret</code></li>
<li><strong>readOnly</strong>: a flag indicating whether the storage will be mounted as read only. Defaults to false which means a read/write mount. This setting will impact the ReadOnly setting in VolumeMounts as well.</li>
</ul>
<p>During storage provisioning, a secret named by <code>secretName</code> is created for the mounting credentials. If the cluster has enabled both <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreffer">RBAC</a> and <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#controller-roles" target="_blank" rel="noopener noreffer">Controller Roles</a>, add the create permission of resource <code>secret</code> for clusterrole <code>system:controller:persistent-volume-binder</code>.</p>
<p>In a multi-tenancy context, it is strongly recommended to set the value for <code>secretNamespace</code> explicitly, otherwise the storage account credentials may be read by other users.</p>
<h4 id="portworx-volume">Portworx Volume</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>portworx-io-priority-high<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/portworx-volume<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">repl</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">snap_interval</span><span class="p">:</span><span class="w">   </span><span class="s2">&#34;70&#34;</span><span class="w">
</span><span class="w">  </span><span class="k">io_priority</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;high&#34;</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>fs</strong>: filesystem to be laid out: none/xfs/ext4 (default: ext4).</li>
<li><strong>block_size</strong>: block size in Kbytes (default: 32).</li>
<li><strong>repl</strong>: number of synchronous replicas to be provided in the form of replication factor <code>1..3</code> (default: 1) A string is expected here i.e. <code>&quot;1&quot;</code> and not <code>1</code>.</li>
<li><strong>io_priority</strong>: determines whether the volume will be created from higher performance or a lower priority storage <code>high/medium/low</code> (default: <code>low</code>).</li>
<li><strong>snap_interval</strong>: clock/time interval in minutes for when to trigger snapshots. Snapshots are incremental based on difference with the prior snapshot, 0 disables snaps (default: 0). A string is expected here i.e. &ldquo;70&rdquo; and not 70.</li>
<li><strong>aggregation_level</strong>: specifies the number of chunks the volume would be distributed into, 0 indicates a non-aggregated volume (default: 0). A string is expected here i.e. &ldquo;0&rdquo; and not 0</li>
<li><strong>ephemeral</strong>: specifies whether the volume should be cleaned-up after unmount or should be persistent. emptyDir use case can set this value to true and persistent volumes use case such as for databases like Cassandra should set to false, true/false (default false). A string is expected here i.e. &ldquo;true&rdquo; and not true.</li>
</ul>
<h4 id="scaleio">ScaleIO</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>slow<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/scaleio<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">gateway</span><span class="p">:</span><span class="w"> </span>https<span class="p">:</span>//<span class="m">192.168.99.200</span><span class="p">:</span><span class="m">443</span>/api<span class="w">
</span><span class="w">  </span><span class="k">system</span><span class="p">:</span><span class="w"> </span>scaleio<span class="w">
</span><span class="w">  </span><span class="k">protectionDomain</span><span class="p">:</span><span class="w"> </span>pd0<span class="w">
</span><span class="w">  </span><span class="k">storagePool</span><span class="p">:</span><span class="w"> </span>sp1<span class="w">
</span><span class="w">  </span><span class="k">storageMode</span><span class="p">:</span><span class="w"> </span>ThinProvisioned<span class="w">
</span><span class="w">  </span><span class="k">secretRef</span><span class="p">:</span><span class="w"> </span>sio-secret<span class="w">
</span><span class="w">  </span><span class="k">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">  </span><span class="k">fsType</span><span class="p">:</span><span class="w"> </span>xfs<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>provisioner</strong>: attribute is set to <code>kubernetes.io/scaleio</code></li>
<li><strong>gateway</strong>: address to a ScaleIO API gateway (required)</li>
<li><strong>system</strong>: the name of the ScaleIO system (required)</li>
<li><strong>protectionDomain</strong>: the name of the ScaleIO protection domain (required)</li>
<li><strong>storagePool</strong>: the name of the volume storage pool (required)</li>
<li><strong>storageMode</strong>: the storage provision mode: ThinProvisioned (default) or ThickProvisioned</li>
<li><strong>secretRef</strong>: reference to a configured Secret object (required)</li>
<li><strong>readOnly</strong>: specifies the access mode to the mounted volume (default false)</li>
<li><strong>fsType</strong>: the file system to use for the volume (default ext4)</li>
</ul>
<p>The ScaleIO Kubernetes volume plugin requires a configured Secret object. The secret must be created with type <code>kubernetes.io/scaleio</code> and use the same namespace value as that of the PVC where it is referenced as shown in the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl create secret generic sio-secret --type<span class="o">=</span><span class="s2">&#34;kubernetes.io/scaleio&#34;</span> <span class="se">\
</span><span class="se"></span>--from-literal<span class="o">=</span><span class="nv">username</span><span class="o">=</span>sioadmin --from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span><span class="nv">d2NABDNjMA</span><span class="o">==</span> <span class="se">\
</span><span class="se"></span>--namespace<span class="o">=</span>default
</code></pre></td></tr></table>
</div>
</div><h4 id="storageos">StorageOS</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>fast<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/storageos<span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">pool</span><span class="p">:</span><span class="w"> </span>default<span class="w">
</span><span class="w">  </span><span class="k">description</span><span class="p">:</span><span class="w"> </span>Kubernetes<span class="w"> </span>volume<span class="w">
</span><span class="w">  </span><span class="k">fsType</span><span class="p">:</span><span class="w"> </span>ext4<span class="w">
</span><span class="w">  </span><span class="k">adminSecretNamespace</span><span class="p">:</span><span class="w"> </span>default<span class="w">
</span><span class="w">  </span><span class="k">adminSecretName</span><span class="p">:</span><span class="w"> </span>storageos-secret<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>pool</strong>: The name of the StorageOS distributed capacity pool to provision the volume from. Uses the <code>default</code> pool which is normally present if not specified.</li>
<li><strong>description</strong>: The description to assign to volumes that were created dynamically. All volume descriptions will be the same for the storage class, but different storage classes can be used to allow descriptions for different use cases. Defaults to <code>Kubernetes volume</code>.</li>
<li><strong>fsType</strong>: The default filesystem type to request. Note that user-defined rules within StorageOS may override this value. Defaults to ext4.</li>
<li><strong>adminSecretNamespace</strong>: The namespace where the API configuration secret is located. Required if adminSecretName set.</li>
<li><strong>adminSecretName</strong>: The name of the secret to use for obtaining the StorageOS API credentials. If not specified, default values will be attempted.</li>
</ul>
<p>The StorageOS Kubernetes volume plugin can use a Secret object to specify an endpoint and credentials to access the StorageOS API. This is only required when the defaults have been changed. The secret must be created with type <code>kubernetes.io/storageos</code> as shown in the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl create secret generic storageos-secret <span class="se">\
</span><span class="se"></span>--type<span class="o">=</span><span class="s2">&#34;kubernetes.io/storageos&#34;</span> <span class="se">\
</span><span class="se"></span>--from-literal<span class="o">=</span><span class="nv">apiAddress</span><span class="o">=</span>tcp://localhost:5705 <span class="se">\
</span><span class="se"></span>--from-literal<span class="o">=</span><span class="nv">apiUsername</span><span class="o">=</span>storageos <span class="se">\
</span><span class="se"></span>--from-literal<span class="o">=</span><span class="nv">apiPassword</span><span class="o">=</span>storageos <span class="se">\
</span><span class="se"></span>--namespace<span class="o">=</span>default
</code></pre></td></tr></table>
</div>
</div><p>Secrets used for dynamically provisioned volumes may be created in any namespace and referenced with the <code>adminSecretNamespace</code> parameter. Secrets used by pre-provisioned volumes must be created in the same namespace as the PVC that references it.</p>
<h4 id="local">Local</h4>
<p><strong>FEATURE STATE</strong>: Kubernetes v1.14 stable</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>local-storage<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>kubernetes.io/no-provisioner<span class="w">
</span><span class="w"></span><span class="k">volumeBindingMode</span><span class="p">:</span><span class="w"> </span>WaitForFirstConsumer<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Local volumes do not currently support dynamic provisioning, however a StorageClass should still be created to delay volume binding until pod scheduling. This is specified by the <code>WaitForFirstConsumer</code> volume binding mode.</p>
<p>Delaying volume binding allows the scheduler to consider all of a pod’s scheduling constraints when choosing an appropriate PersistentVolume for a PersistentVolumeClaim.</p>
<h2 id="nfs-storageclass">nfs-storageclass</h2>
<h3 id="部署-nfs-server">部署 NFS server</h3>
<p>略</p>
<h3 id="部署-nfs-client">部署 NFS client</h3>
<blockquote>
<p>参考：<a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client">https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client</a></p>
</blockquote>
<p><strong>nfs-client</strong> is an automatic provisioner that use your <em>existing and already configured</em> NFS server to support dynamic provisioning of Kubernetes Persistent Volumes via Persistent Volume Claims. Persistent volumes are provisioned as <code>${namespace}-${pvcName}-${pvName}</code>.</p>
<p>To note again, you must <em>already</em> have an NFS Server.</p>
<h4 id="with-helm">With Helm</h4>
<p>Follow the instructions for the stable helm chart maintained at <a href="https://github.com/helm/charts/tree/master/stable/nfs-client-provisioner">https://github.com/helm/charts/tree/master/stable/nfs-client-provisioner</a></p>
<p>The tl;dr is</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ helm install stable/nfs-client-provisioner --set nfs.server<span class="o">=</span>x.x.x.x --set nfs.path<span class="o">=</span>/exported/path
</code></pre></td></tr></table>
</div>
</div><h4 id="without-helm">Without Helm</h4>
<p><strong>Step 1: Get connection information for your NFS server</strong>. Make sure your NFS server is accessible from your Kubernetes cluster and get the information you need to connect to it. At a minimum you will need its hostname.</p>
<p><strong>Step 2: Get the NFS-Client Provisioner files</strong>. To setup the provisioner you will download a set of YAML files, edit them to add your NFS server&rsquo;s connection information and then apply each with the <code>kubectl</code> / <code>oc</code> command.</p>
<p>Get all of the files in the <a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client/deploy" target="_blank" rel="noopener noreffer">deploy</a> directory of this repository. These instructions assume that you have cloned the <a href="https://github.com/kubernetes-incubator/external-storage" target="_blank" rel="noopener noreffer">external-storage</a> repository and have a bash-shell open in the <code>nfs-client</code> directory.</p>
<p><strong>Step 3: Setup authorization</strong>. If your cluster has RBAC enabled or you are running OpenShift you must authorize the provisioner. If you are in a namespace/project other than &ldquo;default&rdquo; edit <code>deploy/rbac.yaml</code>.</p>
<p><strong>Kubernetes:</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Set the subject of the RBAC objects to the current namespace where the provisioner is being deployed</span>
$ <span class="nv">NS</span><span class="o">=</span><span class="k">$(</span>kubectl config get-contexts<span class="p">|</span>grep -e <span class="s2">&#34;^\*&#34;</span> <span class="p">|</span>awk <span class="s1">&#39;{print $5}&#39;</span><span class="k">)</span>
$ <span class="nv">NAMESPACE</span><span class="o">=</span><span class="si">${</span><span class="nv">NS</span><span class="k">:-</span><span class="nv">default</span><span class="si">}</span>
$ sed -i<span class="s1">&#39;&#39;</span> <span class="s2">&#34;s/namespace:.*/namespace: </span><span class="nv">$NAMESPACE</span><span class="s2">/g&#34;</span> ./deploy/rbac.yaml
$ kubectl create -f deploy/rbac.yaml
</code></pre></td></tr></table>
</div>
</div><p><strong>OpenShift:</strong></p>
<p>On some installations of OpenShift the default admin user does not have cluster-admin permissions. If these commands fail refer to the OpenShift documentation for <strong>User and Role Management</strong> or contact your OpenShift provider to help you grant the right permissions to your admin user.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># Set the subject of the RBAC objects to the current namespace where the provisioner is being deployed</span>
$ <span class="nv">NAMESPACE</span><span class="o">=</span><span class="sb">`</span>oc project -q<span class="sb">`</span>
$ sed -i<span class="s1">&#39;&#39;</span> <span class="s2">&#34;s/namespace:.*/namespace: </span><span class="nv">$NAMESPACE</span><span class="s2">/g&#34;</span> ./deploy/rbac.yaml
$ oc create -f deploy/rbac.yaml
$ oadm policy add-scc-to-user hostmount-anyuid system:serviceaccount:<span class="nv">$NAMESPACE</span>:nfs-client-provisioner
</code></pre></td></tr></table>
</div>
</div><p><strong>Step 4: Configure the NFS-Client provisioner</strong></p>
<p>Note: To deploy to an ARM-based environment, use: <code>deploy/deployment-arm.yaml</code> instead, otherwise use <code>deploy/deployment.yaml</code>.</p>
<p>Next you must edit the provisioner&rsquo;s deployment file to add connection information for your NFS server. Edit <code>deploy/deployment.yaml</code> and replace the two occurences of <code>&lt;YOUR NFS SERVER HOSTNAME&gt;</code> with your server&rsquo;s hostname.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">kind</span><span class="p">:</span><span class="w"> </span>Deployment<span class="w">
</span><span class="w"></span><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>apps/v1<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>nfs-client-provisioner<span class="w">
</span><span class="w"></span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">  </span><span class="k">selector</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">matchLabels</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">app</span><span class="p">:</span><span class="w"> </span>nfs-client-provisioner<span class="w">
</span><span class="w">  </span><span class="k">strategy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span>Recreate<span class="w">
</span><span class="w">  </span><span class="k">template</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">labels</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="k">app</span><span class="p">:</span><span class="w"> </span>nfs-client-provisioner<span class="w">
</span><span class="w">    </span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">serviceAccountName</span><span class="p">:</span><span class="w"> </span>nfs-client-provisioner<span class="w">
</span><span class="w">      </span><span class="k">containers</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>nfs-client-provisioner<span class="w">
</span><span class="w">          </span><span class="k">image</span><span class="p">:</span><span class="w"> </span>quay.io/external_storage/nfs-client-provisioner<span class="p">:</span>latest<span class="w">
</span><span class="w">          </span><span class="k">volumeMounts</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>nfs-client-root<span class="w">
</span><span class="w">              </span><span class="k">mountPath</span><span class="p">:</span><span class="w"> </span>/persistentvolumes<span class="w">
</span><span class="w">          </span><span class="k">env</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>PROVISIONER_NAME<span class="w">
</span><span class="w">              </span><span class="k">value</span><span class="p">:</span><span class="w"> </span>fuseim.pri/ifs<span class="w">
</span><span class="w">            </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>NFS_SERVER<span class="w">
</span><span class="w">              </span><span class="k">value</span><span class="p">:</span><span class="w"> </span>&lt;YOUR<span class="w"> </span>NFS<span class="w"> </span>SERVER<span class="w"> </span>HOSTNAME<span class="sd">&gt;
</span><span class="sd">            - name: NFS_PATH</span><span class="w">
</span><span class="w">              </span><span class="k">value</span><span class="p">:</span><span class="w"> </span>/var/nfs<span class="w">
</span><span class="w">      </span><span class="k">volumes</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="k">name</span><span class="p">:</span><span class="w"> </span>nfs-client-root<span class="w">
</span><span class="w">          </span><span class="k">nfs</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="k">server</span><span class="p">:</span><span class="w"> </span>&lt;YOUR<span class="w"> </span>NFS<span class="w"> </span>SERVER<span class="w"> </span>HOSTNAME<span class="sd">&gt;
</span><span class="sd">            path: /var/nfs</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>You may also want to change the PROVISIONER_NAME above from <code>fuseim.pri/ifs</code> to something more descriptive like <code>nfs-storage</code>, but if you do remember to also change the PROVISIONER_NAME in the storage class definition below:</p>
<p>This is <code>deploy/class.yaml</code> which defines the NFS-Client&rsquo;s Kubernetes Storage Class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>storage.k8s.io/v1<span class="w">
</span><span class="w"></span><span class="k">kind</span><span class="p">:</span><span class="w"> </span>StorageClass<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>managed-nfs-storage<span class="w">
</span><span class="w"></span><span class="k">provisioner</span><span class="p">:</span><span class="w"> </span>fuseim.pri/ifs<span class="w"> </span><span class="c"># or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;</span><span class="w">
</span><span class="w"></span><span class="k">parameters</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">archiveOnDelete</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;false&#34;</span><span class="w"> </span><span class="c"># When set to &#34;false&#34; your PVs will not be archived</span><span class="w">
</span><span class="w">                           </span><span class="c"># by the provisioner upon deletion of the PVC.</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">kubectl create -f deploy/deployment.yaml -f deploy/class.yaml
</code></pre></td></tr></table>
</div>
</div><p><strong>Step 5: Finally, test your environment!</strong></p>
<p>Now we&rsquo;ll test your NFS provisioner.</p>
<p>Deploy:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ kubectl create -f deploy/test-claim.yaml -f deploy/test-pod.yaml
</code></pre></td></tr></table>
</div>
</div><p>Now check your NFS Server for the file <code>SUCCESS</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">kubectl delete -f deploy/test-pod.yaml -f deploy/test-claim.yaml
</code></pre></td></tr></table>
</div>
</div><p>Now check the folder has been deleted.</p>
<p><strong>Step 6: Deploying your own PersistentVolumeClaims</strong>. To deploy your own PVC, make sure that you have the correct <code>storage-class</code> as indicated by your <code>deploy/class.yaml</code> file.</p>
<p>For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="k">kind</span><span class="p">:</span><span class="w"> </span>PersistentVolumeClaim<span class="w">
</span><span class="w"></span><span class="k">apiVersion</span><span class="p">:</span><span class="w"> </span>v1<span class="w">
</span><span class="w"></span><span class="k">metadata</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">name</span><span class="p">:</span><span class="w"> </span>test-claim<span class="w">
</span><span class="w">  </span><span class="k">annotations</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">volume.beta.kubernetes.io/storage-class</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;managed-nfs-storage&#34;</span><span class="w">
</span><span class="w"></span><span class="k">spec</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="k">accessModes</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- ReadWriteMany<span class="w">
</span><span class="w">  </span><span class="k">resources</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="k">requests</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="k">storage</span><span class="p">:</span><span class="w"> </span>1Mi<span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p><strong>Step 7: Change the default StorageClass</strong></p>
<blockquote>
<p>参考：<a href="https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/">https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/</a></p>
</blockquote>
<ol>
<li>
<p>List the StorageClasses in your cluster:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get storageclass
</code></pre></td></tr></table>
</div>
</div><p>The output is similar to this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">NAME                 PROVISIONER               AGE
standard <span class="o">(</span>default<span class="o">)</span>   kubernetes.io/gce-pd      1d
gold                 kubernetes.io/gce-pd      1d
</code></pre></td></tr></table>
</div>
</div><p>The default StorageClass is marked by (default).</p>
</li>
<li>
<p>Mark the default StorageClass as non-default:</p>
<p>The default StorageClass has an annotation <code>storageclass.kubernetes.io/is-default-class</code> set to <code>true</code>. Any other value or absence of the annotation is interpreted as <code>false</code>.</p>
<p>To mark a StorageClass as non-default, you need to change its value to <code>false</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl patch storageclass &lt;your-class-name&gt; -p <span class="s1">&#39;{&#34;metadata&#34;: {&#34;annotations&#34;:{&#34;storageclass.kubernetes.io/is-default-class&#34;:&#34;false&#34;}}}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>where <code>&lt;your-class-name&gt;</code> is the name of your chosen StorageClass.</p>
</li>
<li>
<p>Mark a StorageClass as default:</p>
<p>Similarly to the previous step, you need to add/set the annotation <code>storageclass.kubernetes.io/is-default-class=true</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl patch storageclass &lt;your-class-name&gt; -p <span class="s1">&#39;{&#34;metadata&#34;: {&#34;annotations&#34;:{&#34;storageclass.kubernetes.io/is-default-class&#34;:&#34;true&#34;}}}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>Please note that at most one StorageClass can be marked as default. If two or more of them are marked as default, a <code>PersistentVolumeClaim</code> without <code>storageClassName</code> explicitly specified cannot be created.</p>
</li>
<li>
<p>Verify that your chosen StorageClass is default:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get storageclass
</code></pre></td></tr></table>
</div>
</div><p>The output is similar to this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">NAME             PROVISIONER               AGE
standard         kubernetes.io/gce-pd      1d
gold <span class="o">(</span>default<span class="o">)</span>   kubernetes.io/gce-pd      1d
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2019-10-19</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/index.md" target="_blank">阅读原始文档</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" data-title="Nfs-Storageclsss-20191019-官方文档阅读笔记"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" data-title="Nfs-Storageclsss-20191019-官方文档阅读笔记"><i class="fab fa-hacker-news fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" data-title="Nfs-Storageclsss-20191019-官方文档阅读笔记"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://msdemt.github.io/nfs-storageclsss-20191019-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" data-title="Nfs-Storageclsss-20191019-官方文档阅读笔记" data-ralateuid="xxxx"><i class="fab fa-weibo fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/cert-manager-v0.11-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="prev" rel="prev" title="Cert Manager v0.11 官方文档阅读笔记"><i class="fas fa-angle-left fa-fw"></i>Cert Manager v0.11 官方文档阅读笔记</a>
            <a href="/centos7%E6%90%AD%E5%BB%BAnfs-server-20191019/" class="next" rel="next" title="Centos7搭建NFS-Server-20191019">Centos7搭建NFS-Server-20191019<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.72.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">hekai</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.8/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
